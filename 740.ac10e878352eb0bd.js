"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[740],{44485:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_o});var a=n(31981),i=n(95178),r=n(96e3),l=n(85439),s=n(36380),o=n(61391),c=n(60319),d=n(68826),u=n(32782),h=n(67550),Z=n(79906),p=n(7671),m=n(38484),f=n(78287),g=n(83249),x=n(2784),b=n(21560),v=n(73557),y=n(39857),C=n(24264),w=n(87833),B=n(23690),S=n(14084),k=n(86512),X=n(12366),_=n(13230),K=n(99487),j=n(48650);const P=(0,x.createContext)({});var E=n(23657),O=n(30182),T=n(34156),A=n(56302),D=n(76260),M=n(55893),L=n(22134),I=n(6982),R=n(68220),G=n(80680),N=n(2180),z=n(52903);const W=x.lazy((()=>n.e(592).then(n.bind(n,37629))));function $(){var e;const{t}=(0,b.$G)("page_character"),{characterSheet:n,character:{key:a}}=(0,x.useContext)(_.K),[i,r]=(0,x.useState)(!1),l=(0,N.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(W,{show:i,onHide:()=>r(!1),onSelect:l})}),(0,z.tZ)(g.Z,{color:"info",onClick:()=>r(!0),startIcon:(0,z.tZ)(G.Z,{characterKey:a}),children:null!=(e=null==n?void 0:n.name)?e:t("selectCharacter")})]})}var V=n(84485),F=n(42523),q=n(56961),H=n(23570),U=n(2995),Y=n(62197),J=n(35322),Q=n(34048),ee=n(4453),te=n(86569),ne=n(79410),ae=n(69698),ie=n(75636),re=n(15030);function le(){const{modalOpen:e}=(0,x.useContext)(j.M),{setFormulaData:t}=(0,x.useContext)(j.M),n=(0,x.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,z.tZ)(ae.Z,{open:!!e,onClose:n,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:"Formulas & Calculations",action:(0,z.tZ)(B.Z,{onClick:n})}),(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.tZ)(se,{})})]})})}function se(){const{data:e}=(0,x.useContext)(K.R),{data:t}=(0,x.useContext)(j.M),n=(0,ie.U)(null!=t?t:e);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,z.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:n.map((([e,t])=>(0,z.tZ)(oe,{displayNs:t,sectionKey:e},e)))})})}function oe({sectionKey:e,displayNs:t}){const{data:n}=(0,x.useContext)(K.R),{database:a}=(0,x.useContext)(T.t),{data:i}=(0,x.useContext)(j.M),r=(0,x.useMemo)((()=>(0,ie.f)(null!=i?i:n,e,a)),[a,i,n,e]);if(!r)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:l,icon:s,action:o}=r;return(0,z.BX)(w.Z,{sx:{mb:1},children:[(0,z.tZ)(ee.Z,{avatar:s&&(0,z.tZ)(ne.Z,{size:2,src:s}),title:l,action:o&&(0,z.tZ)(X.Z,{children:o})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,z.tZ)(ce,{node:t},e)))})]})}function ce({node:e}){const{node:t}=(0,x.useContext)(j.M),[n,i]=(0,x.useState)(!1),r=(0,x.useCallback)(((e,t)=>i(t)),[]),l=(0,x.useRef)();return(0,x.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==l||null==(e=l.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[l,e,t]),(0,z.BX)(H.Z,{sx:{bgcolor:"contentDark.main"},expanded:e===t||n,onChange:r,ref:l,children:[(0,z.BX)(U.Z,{expandIcon:(0,z.tZ)(V.Z,{}),children:[(0,z.BX)(Y.Z,{children:[(0,z.tZ)(te.Z,{color:e.info.variant,children:e.info.name})," ",(0,z.tZ)("strong",{children:(0,re.p)(e)})]}),a.Mk.includes(e.info.variant)&&(0,z.tZ)(h.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,z.tZ)(Q.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,z.tZ)(J.Z,{children:e.formulas.map(((e,t)=>(0,z.tZ)(Y.Z,{component:"div",children:e},t)))})]})}var de=n(33927),ue=n(41075),he=n(107),Ze=n(15873),pe=n(17885),me=n(32510),fe=n(5658),ge=n(27216),xe=n(66198),be=n(41033),ve=n(41319),ye=n(25576),Ce=n(39099),we=n(93827),Be=n(65992),Se=n(85801);const ke=["expand"],Xe=(0,Be.ZP)((e=>{const t=(0,we.Z)(e,ke);return(0,z.tZ)(Se.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var _e=n(38553),Ke=n(89977),je=n(13900);const Pe=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Ee=(0,Be.ZP)(_e.Z)({display:"flex"});function Oe(e){let{name:t,children:n,value:a,placeholder:i,defaultValue:r=0,onValueChange:l,percent:s=!1,disabled:o=!1,onReset:c}=e,d=(0,we.Z)(e,Pe);return(0,z.BX)(Ee,Object.assign({},d,{children:[n,(0,z.tZ)(je.Z,{sx:{px:1},children:t}),(0,z.tZ)(Ke.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,z.tZ)(Ke.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:i,value:a,onChange:l,disabled:o,endAdornment:s?"%":void 0})}),(0,z.tZ)(g.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>c?c():l(r),disabled:o||a===r,children:(0,z.tZ)(me.Z,{})})]}))}let Te,Ae=e=>e;function De(){const{t:e}=(0,b.$G)("ui"),{characterDispatch:t}=(0,x.useContext)(_.K),{data:n}=(0,x.useContext)(K.R),[i,r]=(0,x.useState)(!1),l=(0,x.useCallback)((()=>r(!i)),[r,i]),s=n.get(ve.ri.enemy.level),o=n.get(ve.ri.enemy.defRed),c=n.get(ve.ri.enemy.defIgn),d=(0,x.useCallback)((()=>t({enemyOverride:{}})),[t]);return(0,z.BX)(w.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,z.tZ)(xe.Z,{size:"small",color:"success",label:(0,z.BX)("span",{children:[s.info.name," ",(0,z.tZ)("strong",{children:s.value})]})}),a.fR.map((e=>(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Me,{element:e})},e))),(0,z.BX)(Y.Z,{children:["DEF Red. ",(0,re.p)(o)]}),(0,z.BX)(Y.Z,{children:["DEF Ignore ",(0,re.p)(c)]}),(0,z.BX)(h.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,z.tZ)(g.Z,{size:"small",color:"error",onClick:d,startIcon:(0,z.tZ)(me.Z,{}),children:e(Te||(Te=Ae`reset`))}),(0,z.tZ)(Xe,{expand:i,onClick:l,"aria-expanded":i,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,z.tZ)(V.Z,{})})]})]}),(0,z.tZ)(be.Z,{in:i,timeout:"auto",unmountOnExit:!0,children:(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.tZ)(Le,{})})})]})}function Me({element:e}){const{data:t}=(0,x.useContext)(K.R),n=t.get(ve.ri.enemy[`${e}_res_`]),a=!isFinite(n.value),i=(0,z.tZ)(Ce.Z,{ele:e,iconProps:pe.mX}),r=a?(0,z.BX)("span",{children:[i," \u221e"]}):(0,z.BX)("span",{children:[i," ",(0,z.tZ)("strong",{children:(0,re.p)(n)})]});return(0,z.tZ)(te.Z,{color:e,children:r})}function Le({bsProps:e={xs:12,md:6}}){var t,n,i;const{character:{enemyOverride:r},characterDispatch:l}=(0,x.useContext)(_.K),{data:s}=(0,x.useContext)(K.R),o=null!=(t=r.enemyLevel)?t:s.get(ve.ri.lvl).value,c=null!=(n=r.enemyDefIgn_)?n:0,d=null!=(i=r.enemyDefRed_)?i:0;return(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(g.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Oe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyLevel")}),value:o,placeholder:ye.ZP.getStr("enemyLevel"),defaultValue:s.get(ve.ri.lvl).value,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyLevel",value:e}),onReset:()=>l({type:"enemyOverride",statKey:"enemyLevel",value:void 0})})})),a.fR.map((t=>{const n=`${t}_enemyRes_`,a=r[n],i=a===Number.MAX_VALUE;return(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Oe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)(te.Z,{color:t,children:(0,z.tZ)("b",{children:ye.ZP.get(n)})}),value:void 0!==a?i?1/0:a:10,placeholder:i?"\u221e ":ye.ZP.getStr(n),defaultValue:10,onValueChange:e=>l({type:"enemyOverride",statKey:n,value:e}),disabled:i,percent:!0,children:(0,z.tZ)(g.Z,{color:t,onClick:()=>l({type:"enemyOverride",statKey:n,value:i?10:Number.MAX_VALUE}),startIcon:i?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),children:"Immunity"})})}),t)})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Oe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefIgn_")}),value:c,placeholder:ye.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefIgn_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Oe,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefRed_")}),value:d,placeholder:ye.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefRed_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}var Ie=n(39282),Re=n(68330);let Ge,Ne=e=>e;const ze={xs:1,md:2,lg:3};function We({open:e,onClose:t}){const{t:n}=(0,b.$G)("page_character");return(0,z.tZ)(ae.Z,{open:e,onClose:t,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:n(Ge||(Ge=Ne`addStats.title`)),action:(0,z.tZ)(B.Z,{onClick:t})}),(0,z.tZ)(p.Z,{sx:{pt:0},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(Fe,{}),(0,z.tZ)(De,{}),(0,z.tZ)(et,{})]})})]})})}const $e=[...ve.lR],Ve=(e,t)=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:e},t);function Fe(){const{t:e}=(0,b.$G)("page_character"),{character:{bonusStats:t},characterDispatch:n}=(0,x.useContext)(_.K),a=(0,x.useCallback)((e=>n({bonusStats:e})),[n]);return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{sx:{display:"flex"},children:(0,z.BX)(ue.ZP,{container:!0,columns:ze,sx:{pt:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(he.Z,{severity:"info",variant:"filled",children:(0,z.BX)(b.cC,{i18nKey:"addStats.info",t:e,children:["You can use these fields to add buffs/debuffs not directly supported in GO, such as food buffs, abyss cards, or Superconduct. Please refer to the",(0,z.tZ)("a",{href:"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki",children:"Genshin Impact Wiki"}),"for specific values."]})})}),(0,z.tZ)(Re.Z,{statKeys:$e,statFilters:t,setStatFilters:a,wrapperFunc:Ve})]})})})}const qe=["eleMas","critRate_","critDMG_","enerRech_","heal_"],He=["hp","atk","def",...qe].map((e=>ve.ri.total[e])),Ue=["atk_","atk","hp_","hp","def_","def",...qe],Ye=[...ye.hX,...ye.Sx,"stamina","incHeal_","shield_","cdRed_"],Je=ve.lR.filter((e=>!Ue.includes(e)&&!Ye.includes(e)));function Qe({nodes:e,extra:t}){const{data:n,oldData:a}=(0,x.useContext)(K.R);return(0,z.BX)(Ie.lD,{children:[e.map((e=>{var t;return(0,z.tZ)(Ie.JW,{component:Ze.ZP,node:n.get(e),oldValue:null==a||null==(t=a.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function et(){const{characterSheet:e}=(0,x.useContext)(_.K),{data:t}=(0,x.useContext)(K.R),n=t.get(ve.ri.special),a=e.elementKey,i=e.isMelee(),r=(0,x.useMemo)((()=>Ye.filter((e=>!e.includes(a)&&(i&&e.includes("physical"),!0))).map((e=>ve.ri.total[e])).filter((e=>!!t.get(e).value))),[t,a,i]),l=(0,x.useMemo)((()=>Je.map((e=>ve.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,columns:ze,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Main Stats",children:(0,z.tZ)(Qe,{nodes:He,extra:n&&(0,z.BX)(Ze.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,z.tZ)("b",{children:"Special:"})," ",(0,z.BX)(te.Z,{color:n.info.variant,children:[n.info.icon," ",n.info.name]})]}),(0,z.tZ)("span",{children:(0,re.p)(n)})]})})})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Other Stats",children:(0,z.tZ)(Qe,{nodes:r})})}),!!l.length&&(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(tt,{title:"Misc Stats",children:(0,z.tZ)(Qe,{nodes:l})})})]})})})}function tt({title:e,children:t}){return(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.tZ)(h.Z,{display:"flex",justifyContent:"space-between",children:(0,z.tZ)(Y.Z,{variant:"subtitle1",children:e})})}),t]})}var nt=n(12761),at=n(36269),it=n(46342),rt=n(62469),lt=n(85162),st=n(23119),ot=n(94380),ct=n(92794),dt=n(51290),ut=n(45269),ht=n(11615),Zt=n(23485),pt=n(12702),mt=n(58489);const ft=(0,x.createContext)(void 0);var gt=n(64212),xt=n(13810),bt=n(2754),vt=n(93290);var yt=n(64985),Ct=n(6094);function wt(e,t,n=!1){const i=new Set,r=new Set;function l(e,t){return t?i.add(e):e.operands.forEach((e=>i.has(e)&&r.add(e))),e}const s=new Set;if(e=(0,yt.uW)(e,(e=>e),(e=>{const{operation:t}=e;switch(t){case"read":return s.add(e.path[1]),l(e,!0);case"add":{const t=e.operands.filter((e=>i.has(e))),n=e.operands.filter((e=>!i.has(e)));if(0===n.length)return l(e,!0);if(t.length<=1)return l(e,!1);const a=l((0,Ct.Sm)(...t),!0);return l((0,Ct.Sm)(a,...n),!1)}case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));return l(e,0===t.length||1===t.length&&i.has(t[0]))}case"const":return l(e,!0);case"res":case"threshold":case"sum_frac":case"max":case"min":return l(e,!1);default:(0,nt.UT)(t)}})),e.filter((e=>i.has(e))).forEach((e=>r.add(e))),[...r].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===s.size)return{nodes:e,arts:t};let o=-1;function c(){for(;s.has(""+ ++o););return`${o}`}const d=[...r].filter((e=>"const"!==e.operation)),u=new Map(d.map((e=>[e,n||"read"!==e.operation||"dyn"!==e.path[0]?(0,Ct.Cj)(c()):e])));function h(e){const t=(0,vt.CG)([...u.keys()],{dyn:(0,nt.Ay)(e,(e=>(0,Ct.a9)(e)))},(e=>!0));return Object.fromEntries([...u.values()].map(((e,n)=>[e.path[1],t[n].value])))}const Z={nodes:e=(0,yt.uW)(e,(e=>{var t;return null!=(t=u.get(e))?t:e}),(e=>e)),arts:{base:h(t.base),values:(0,nt.K8)(a.Ex,(e=>t.values[e].map((({id:e,set:t,values:n})=>({id:e,set:t,values:h(n)})))))}},p=Object.entries(h({}));for(const a of Object.values(Z.arts.values))for(const{values:e}of a)for(const[t,n]of p)e[t]-=n;return Z}function Bt(e,t,n){var i;let r=!1;const l=!(null!=(i=n.rainbow)&&i.length),s=Object.keys(e.base),o=new Set(Object.entries(n).filter((([e,t])=>t.length)).map((([e])=>e))),c=new Set(Object.entries(n).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),d=(0,nt.K8)(a.Ex,(n=>{const a=e.values[n],i=a.filter((e=>{let n=0;return a.every((a=>{const i=s.every((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>=(null!=(i=e.values[t])?i:0)})),r=s.some((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>(null!=(i=e.values[t])?i:0)})),d=i&&(r||a.id>e.id),u=l&&!o.has(a.set)&&!c.has(e.set)||e.set===a.set;return d&&u&&n++,n<t}))}));return i.length!==a.length&&(r=!0),i}));return r?{base:e.base,values:d}:e}function St(e,t,n){const i=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),r={arts:t};for(;;){const t=(0,nt.K8)(a.Ex,(e=>_t(r.arts.values[e]))),l=(0,nt.K8)(a.Ex,(e=>Xt(Object.entries(t).map((t=>t[0]===e?i:t[1])).filter((e=>e)))));let s=!1;const o=(0,nt.K8)(a.Ex,(t=>{const a=r.arts.values[t].filter((a=>{const i=Xt([_t([a]),l[t]]),r=Kt(e,i);return e.every(((e,t)=>{var a;return r.get(e).max>=(null!=(a=n[t])?a:-1/0)}))}));return a.length!==r.arts.values[t].length&&(s=!0),a}));if(!s)break;r.arts={base:r.arts.base,values:o}}return r.arts}function kt(e,t){const n=Kt(e,Xt([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>_t(e)))]));return(0,yt.uW)(e,(e=>{{const{min:t,max:a}=n.get(e);if(t===a)return(0,Ct.a9)(t)}const{operation:t}=e,a=e.operands.map((e=>n.get(e)));switch(t){case"threshold":{const[t,n,i,r]=a;if(t.min>=n.max)return e.operands[2];if(t.max<n.min)return e.operands[3];if(i.max===i.min&&r.max===r.min&&i.min===r.min&&isFinite(i.min))return(0,Ct.a9)(i.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every((e=>n.min<=e.max))}));if(t.length<a.length)return(0,Ct.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every((e=>n.max>=e.min))}));if(t.length<a.length)return(0,Ct.Fp)(...t);break}}return e}),(e=>e))}function Xt(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t[e]?(t[e].min+=n.min,t[e].max+=n.max):t[e]=Object.assign({},n)}))})),t}function _t(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((n=>t[n]={min:e[0].values[n],max:e[0].values[n]})),e.forEach((({values:e})=>{for(const[n,a]of Object.entries(e))t[n]?(t[n].max<a&&(t[n].max=a),t[n].min>a&&(t[n].min=a)):t[n]={min:0,max:a}}))),t}function Kt(e,t){const n=new Map;return(0,yt.aD)(e,(e=>{}),(e=>{var a;const{operation:i}=e,r=e.operands.map((e=>n.get(e)));let l;switch(i){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);l=null!=(a=t[e.path[1]])?a:{min:0,max:0};break;case"const":l=jt([e.value]);break;case"add":case"min":case"max":l={min:vt.aj[i](r.map((e=>e.min))),max:vt.aj[i](r.map((e=>e.max)))};break;case"res":l={min:vt.aj[i]([r[0].max]),max:vt.aj[i]([r[0].min])};break;case"mul":l=r.reduce(((e,t)=>jt([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":l=r[0].min>=r[1].max?r[2]:r[0].max<r[1].min?r[3]:jt([],[r[2],r[3]]);break;case"sum_frac":{const[e,t]=r,n={min:e.min+t.min,max:e.max+t.max};l=n.min<=0&&n.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:jt([e.min/n.min,e.min/n.max,e.max/n.min,e.max/n.max]);break}default:(0,nt.UT)(i)}n.set(e,l)})),n}function jt(e,t=[]){const n=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:n}}function Pt(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Pt=function(e){this.s=e,this.n=e.next},Pt.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Pt(e)}class WorkerCoordinator{constructor(e,t,n){this.prio=void 0,this.commands=void 0,this.workers=void 0,this.workDone=new Map,this._workers=void 0,this.cancel=void 0,this.cancelled=void 0,this.callback=void 0,this.notifyNonEmpty=void 0,this.commands=t.map((e=>new nt.uZ)),this.prio=new Map(t.map(((e,t)=>[e,t]))),this.callback=n,e.forEach((e=>{e.onmessage=t=>this.onMessage(t.data,e),e.onerror=e=>this.onError(e)})),this._workers=e,this.workers=e.map((e=>Promise.resolve(e))),this.cancel=()=>{},this.cancelled=new Promise(((e,t)=>this.cancel=t)),this.cancelled.catch((t=>e.forEach((e=>e.terminate()))))}async execute(e){var t=this;const n=async function(){var n,a=!1,i=!1;try{for(var r,l=function(e){var t,n,a,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,a=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(a&&null!=(t=e[a]))return new Pt(t.call(e));n="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}(e);a=!(r=await l.next()).done;a=!1){const e=r.value;t.add(e)}}catch(s){i=!0,n=s}finally{try{a&&null!=l.return&&await l.return()}finally{if(i)throw n}}}();for(;;){var a;const e=null==(a=this.commands.find((e=>e.length)))?void 0:a.pop();if(void 0===e){const e=await Promise.race([new Promise((e=>this.notifyNonEmpty=()=>e(!0))),Promise.all([...this.workers,n]).then((e=>!1)),this.cancelled]);if(this.notifyNonEmpty=void 0,e)continue;break}const{i:t,w:i}=await Promise.race([...this.workers.map(((e,t)=>e.then((e=>({i:t,w:e}))))),this.cancelled]);this.workers[t]=new Promise((e=>this.workDone.set(i,(()=>e(i))))),i.postMessage(e)}}onError(e){this.cancel(new Error(`Worker Error: ${e.message}`))}onMessage(e,t){void 0!==e.command?this.add(e):"done"===e.resultType?this.workDone.get(t)():this.callback(e,t)}add(e){var t;const n=this.prio.get(e.command);this.commands[n].push(e),null==(t=this.notifyNonEmpty)||t.call(this)}broadcast(e){this._workers.forEach((t=>t.postMessage(e)))}notifiedBroadcast(e){this.workers=this.workers.map((e=>e.then((e=>new Promise((t=>{this.workDone.set(e,(()=>t(e)))})))))),this._workers.forEach((t=>t.postMessage(e)))}}class GOSolver extends WorkerCoordinator{constructor(e,t,a){super(Array(a).fill(NaN).map((e=>new Worker(new URL(n.p+n.u(710),n.b)))),["iterate","split","count"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"count":this.status.total=e.count;break;case"err":this.onError(e)}})),this.maxIterateSize=32e6,this.status=void 0,this.exclusion=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[];const{exclusion:i,topN:r}=e;this.status=t,this.exclusion=i,this.topN=r,this.status.total=NaN,this.buildValues=Array(r).fill({w:void 0,val:-1/0}),this.notifiedBroadcast(this.preprocess(e))}async solve(){const{exclusion:e,maxIterateSize:t}=this;return this.finalizedResults=[],await this.execute([{command:"count",exclusion:e,maxIterateSize:t}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:n,topN:a,exclusion:i,constraints:r}){let l=[...(r=r.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...r.map((e=>e.min)),-1/0];e&&(l.push(e),s.push(-1/0)),l=function(e,t){const n={};for(const[a,i]of Object.entries(t))i.includes(4)&&(n[a]=i.includes(2)?1:3);return(0,yt.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[a,i,r,l]=e.operands;if("read"===a.operation&&"const"===i.operation){const e=a.path[a.path.length-1],s=i.value;if(e in n){if(n[e]<s)return l;if(2===s&&t[e].includes(2))return(0,Ct.Lj)(a,4,r,l)}}return e}))}(l,i),l=(0,vt.tL)(l,{},(e=>!1)),({nodes:l,arts:n}=function(e,t,n,a,i,r){let l=r;const s={pruneNodeRange:!0},o={pruneNodeRange:!0},c={reaffine:!0},d={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let u=0;for(;Object.values(l).some((e=>e))&&u++<20;){if(l.pruneOrder){delete l.pruneOrder;const e=Bt(n,a,i);n!==e&&(n=e,l=Object.assign({},l,s))}if(l.pruneArtRange){delete l.pruneArtRange;const a=St(e,n,t);n!==a&&(n=a,l=Object.assign({},l,o))}if(l.pruneNodeRange){delete l.pruneNodeRange;const t=kt(e,n);e!==t&&(e=t,l=Object.assign({},l,c))}if(l.reaffine){delete l.reaffine;const{nodes:t,arts:a}=wt(e,n);e===t&&n===a||(e=t,n=a,l=Object.assign({},l,d))}}return{nodes:e,arts:n}}(l,s,n,a,i,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),l=(0,vt.tL)(l,{},(e=>!1)),e&&(e=l.pop());return{command:"setup",arts:n,optTarget:l.pop(),plotBase:e,topN:a,constraints:l.map(((e,t)=>({value:e,min:s[t]})))}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var n,a;const{topN:i}=this,r=null!=(n=this.buildValues[i-1].val)?n:-1/0;this.buildValues.filter((({w:e})=>e!==t)),this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(i);const l=null!=(a=this.buildValues[i-1].val)?a:-1/0;r!==l&&this.broadcast({command:"threshold",threshold:l})}}}var Et=n(2313),Ot=n(13264),Tt=n(96511),At=n(13780),Dt=n(79199),Mt=n(91218),Lt=n(89279),It=n(28265),Rt=n(64303);function Gt(e){const{database:t}=(0,x.useContext)(T.t),[n,a]=(0,x.useState)((()=>t.buildSettings.get(e)));(0,x.useEffect)((()=>a(t.buildSettings.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildSettings.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildSetting:n,buildSettingDispatch:(0,x.useCallback)((n=>e&&t.buildSettings.set(e,n)),[e,t])}}let Nt,zt,Wt,$t,Vt=e=>e;var Ft=function(e){return e[e.ToggleToAllow=0]="ToggleToAllow",e[e.ToggleToExclude=1]="ToggleToExclude",e}(Ft||{});function qt({disabled:e=!1,allowListTotal:t}){const{t:n}=(0,b.$G)("page_character_optimize"),{t:r}=(0,b.$G)("page_character"),{character:{key:l}}=(0,x.useContext)(_.K),{silly:s}=(0,x.useContext)(E.E),{buildSetting:{excludedLocations:o,allowLocationsState:c},buildSettingDispatch:d}=Gt(l),{database:u}=(0,x.useContext)(T.t),[Z,m,f]=(0,i.aV)(!1),[v,y]=(0,i.NW)(),S=(0,x.useDeferredValue)(v),[k,K]=(0,x.useState)(""),j=(0,x.useDeferredValue)(k),[P,A]=(0,x.useState)([...a.UB]),D=(0,x.useDeferredValue)(P),[M,L]=(0,x.useState)([...a.yd]),I=(0,x.useDeferredValue)(M),R=(0,x.useMemo)((()=>S&&Object.fromEntries(Array.from(new Set(Object.entries(u.chars.data).filter((([e])=>e!==l)).filter((([e])=>(0,nt.CZ)({element:D,weaponType:I,name:j},(0,Rt.zU)(u,s))(e))))))),[S,u,l,D,I,j,s]),G=Object.entries(R).sort((([e,t],[n,a])=>{const[i,r]=[-1,1],l=u.charMeta.get(e).favorite,s=u.charMeta.get(n).favorite;if(l&&!s)return i;if(s&&!l)return r;const o=Object.values(t.equippedArtifacts).filter((e=>e)).length,c=Object.values(a.equippedArtifacts).filter((e=>e)).length;return o>c?i:c>o?r:e.localeCompare(n)})).map((([e])=>(0,a.V7)(e))),{elementTotals:N,weaponTypeTotals:W,locListTotals:$}=(0,x.useMemo)((()=>{const e={elementTotals:[...a.UB],weaponTypeTotals:[...a.yd],locListTotals:["allowed","excluded"]};return(0,Et.A)(e,(e=>Object.entries(u.chars.data).filter((([e])=>e!==l)).forEach((([t])=>{const n=(0,O.m)(t,u.gender),i=n.elementKey;e.elementTotals[i].total++,R[t]&&e.elementTotals[i].current++;const r=n.weaponTypeKey;e.weaponTypeTotals[r].total++,R[t]&&e.weaponTypeTotals[r].current++;const l=(0,a.V7)(t);G.includes(l)&&(e.locListTotals.allowed.total++,e.locListTotals.excluded.total++,o.includes(l)?e.locListTotals.excluded.current++:e.locListTotals.allowed.current++)}))))}),[R,l,u.chars.data,u.gender,o,G]);(0,x.useEffect)((()=>u.charMeta.followAny((e=>y()))),[y,u]),(0,x.useEffect)((()=>u.chars.followAny((e=>y()))),[y,u]);const[V,F]=(0,x.useState)(!1),H=(0,x.useCallback)((()=>d({excludedLocations:o.filter((e=>!G.includes(e))),allowLocationsState:"customList"})),[d,o,G]),U=(0,x.useCallback)((()=>d({excludedLocations:Array.from(new Set(o.concat(G))),allowLocationsState:"customList"})),[d,o,G]),J=(0,x.useCallback)(((e,t)=>d({allowLocationsState:t})),[d]),Q=(0,x.useCallback)((e=>{const t=[...e],n=t.filter((e=>!o.includes(e))).concat(o.filter((e=>!t.includes(e))));d({excludedLocations:n,allowLocationsState:"customList"})}),[o,d]),ee=(0,x.useCallback)((()=>F(!0)),[]),te=u.chars.keys.length-1,ne=te-o.length,ie="all"===c?te:"customList"===c?ne===te?ne:`${ne}/${te}`:0,re="all"===c?"success":"customList"===c?"info":"secondary";return(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(ae.Z,{open:Z,onClose:f,containerProps:{maxWidth:"xl"},draggable:!1,onMouseUp:ee,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(Y.Z,{variant:"h6",children:n(Nt||(Nt=Vt`excludeChar.title`))}),(0,z.tZ)(pt.Z,{title:(0,z.tZ)(Y.Z,{children:n(zt||(zt=Vt`excludeChar.tooltip`))})}),(0,z.tZ)(h.Z,{flexGrow:1}),(0,z.tZ)(B.Z,{onClick:f,size:"small"})]})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{sx:{pb:0},children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,z.tZ)(mt.Z,{exclusive:!0,baseColor:"secondary",size:"small",value:c,onChange:J,children:xt.Cz.map((t=>(0,z.tZ)(ct.Z,{value:t,disabled:c===t||e,children:n(`excludeChar.states.${t}`)},t)))}),(0,z.tZ)(At.Z,{autoFocus:!0,value:k,onChange:e=>K(e.target.value),label:r("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[(0,z.tZ)(It.Z,{sx:{height:"100%"},onChange:L,value:I,totals:W,size:"small"}),(0,z.tZ)(Lt.Z,{sx:{height:"100%"},onChange:A,value:D,totals:N,size:"small"})]})]})}),(0,z.BX)(p.Z,{sx:{opacity:"customList"===c?1:.6},children:[(0,z.BX)(ue.ZP,{container:!0,pb:1,gap:1,flexWrap:"nowrap",children:[(0,z.tZ)(ue.ZP,{item:!0,xs:6,children:(0,z.BX)(g.Z,{color:"success",fullWidth:!0,onClick:H,children:[n(Wt||(Wt=Vt`excludeChar.modal.allow_all`)),(0,z.tZ)(X.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:$.allowed})})]})}),(0,z.tZ)(ue.ZP,{item:!0,xs:6,children:(0,z.BX)(g.Z,{fullWidth:!0,color:"error",onClick:U,children:[n($t||($t=Vt`excludeChar.modal.disallow_All`)),(0,z.tZ)(X.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:$.excluded})})]})})]}),(0,z.tZ)(Ht,{locList:G,excludedLocations:o,mouseUpDetected:V,setMouseUpDetected:F,toggleList:Q})]})]})}),(0,z.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:n("excludeChar.title")})}),(0,z.BX)(Y.Z,{children:[n("excludeChar.usingState")," ",(0,z.tZ)(X.Z,{color:re,children:n(`excludeChar.states.${c}`)})]}),(0,z.BX)(Y.Z,{children:[n("excludeChar.chars")," ",(0,z.BX)(X.Z,{color:"success",children:[ie," ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX)),n("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[n("excludeChar.artis")," ",(0,z.BX)(X.Z,{color:"success",children:[t," ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX)),n("artSetConfig.allowed")]})]})]})}),(0,z.tZ)(g.Z,{sx:{borderRadius:0,flexShrink:1,minWidth:40},onClick:m,disabled:e,color:"info",children:(0,z.tZ)(Ot.Z,{})})]})]})}function Ht({locList:e,excludedLocations:t,mouseUpDetected:n,setMouseUpDetected:a,toggleList:i}){const[r,l]=(0,x.useState)(new Set),[s,o]=(0,x.useState)();return(0,x.useEffect)((()=>{n&&(a(!1),r.size>0&&(i(r),l(new Set),o(void 0)))}),[r,l,a,n,i]),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:6,sm:7,md:10,lg:12,xl:16},children:e.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Ut,{locKey:e,charList:r,charListMode:s,setCharList:l,setCharListMode:o,selected:!t.includes(e)})},e)))})}function Ut({locKey:e,selected:t,charList:n,charListMode:i,setCharList:r,setCharListMode:l}){const{database:s}=(0,x.useContext)(T.t),o=s.chars.get(s.chars.LocationToCharacterKey(e)),c=(0,x.useCallback)((a=>1===a.buttons&&(i===Ft.ToggleToAllow&&!t||i===Ft.ToggleToExclude&&t)&&r(new Set([...n]).add(e))),[i,t,r,n,e]),d=(0,x.useCallback)((()=>{const a=t?Ft.ToggleToExclude:Ft.ToggleToAllow;l(a),r(new Set([...n]).add(e))}),[t,l,r,n,e]),u=(0,x.useMemo)((()=>0!==n.size),[n.size]),Z=t&&!(i===Ft.ToggleToExclude&&n.has(e))||i===Ft.ToggleToAllow&&n.has(e),p={opacity:Z?void 0:.6,borderColor:Z?"rgb(100,200,100)":"rgb(200,100,100)",borderWidth:"3px",borderStyle:"solid",borderRadius:"8px"},m=(0,x.useMemo)((()=>(0,z.tZ)(h.Z,{fontSize:"0.85em",display:"flex",justifyContent:"space-between",p:.3,children:a.Ex.map((e=>(0,z.tZ)(Dt.Z,{slotKey:e,iconProps:{fontSize:"inherit",sx:{opacity:null!=o&&o.equippedArtifacts[e]?void 0:.5}}},e)))})),[null==o?void 0:o.equippedArtifacts]);return(0,z.BX)(w.Z,{sx:p,children:[(0,z.tZ)(Mt.Z,{characterKey:s.chars.LocationToCharacterKey(e),onMouseDown:d,onMouseEnter:c,disableTooltip:u}),m]})}var Yt=n(38114),Jt=n(78437),Qt=n(48289),en=n(14836);function tn({setKey:e,setNumKey:t,hideHeader:n=!1,conditionalsOnly:a=!1}){var i;const r=(0,Qt.Sk)(e),l=a?null==(i=r.setEffectDocument(t))?void 0:i.filter((e=>"states"in e)):r.setEffectDocument(t);return(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",children:l?(0,z.tZ)(en.Z,{sections:l,hideHeader:n}):null})}var nn=n(1665),an=n(51576);let rn,ln,sn=e=>e;function on({setKey:e,buttonGroupSx:t}){var n;const{t:a}=(0,b.$G)("sheet"),{character:{key:i}}=(0,x.useContext)(_.K),{buildSetting:{artSetExclusion:r},buildSettingDispatch:l}=Gt(i),s=null!=(n=null==r?void 0:r[e])?n:[],o=s.includes(2),c=s.includes(4);return(0,z.BX)(_e.Z,{sx:t,fullWidth:!0,children:[(0,z.tZ)(g.Z,{startIcon:o?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>l({artSetExclusion:(0,xt.sL)(r,e,2)}),color:o?"secondary":"success",endIcon:o?(0,z.tZ)(Yt.Z,{}):(0,z.tZ)(Tt.Z,{}),children:a(rn||(rn=sn`2set`))}),(0,z.tZ)(g.Z,{startIcon:c?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>l({artSetExclusion:(0,xt.sL)(r,e,4)}),color:c?"secondary":"success",endIcon:c?(0,z.tZ)(Yt.Z,{}):(0,z.tZ)(Tt.Z,{}),children:a(ln||(ln=sn`4set`))})]})}let cn,dn,un,hn,Zn,pn,mn,fn,gn,xn,bn,vn,yn,Cn,wn=e=>e;function Bn({disabled:e}){var t,n;const{t:r}=(0,b.$G)(["page_character_optimize","sheet"]),l=(0,x.useContext)(K.R),{database:s}=(0,x.useContext)(T.t),{character:{key:o,conditional:c},characterDispatch:d}=(0,x.useContext)(_.K),{buildSetting:{artSetExclusion:u},buildSettingDispatch:Z}=Gt(o),[m,f]=(0,x.useState)(!1),v=(0,x.useCallback)((()=>f(!0)),[f]),y=(0,x.useCallback)((()=>f(!1)),[f]),[S,k]=(0,i.NW)();(0,x.useEffect)((()=>s.arts.followAny(k)),[s,k]);const j=(0,x.useMemo)((()=>Object.entries(Qt.WO).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers")))),[]),{artKeys:P,artSlotCount:E}=(0,x.useMemo)((()=>{const e=(0,nt.K8)(j,(e=>(0,nt.K8)(a.Ex,(e=>0))));s.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[...j].sort(((t,n)=>+(Xn(e[t])<2)-+(Xn(e[n])<2)));return S&&{artKeys:t,artSlotCount:e}}),[S,s,j]),O=!(null!=(t=u.rainbow)&&t.includes(2)),A=!(null!=(n=u.rainbow)&&n.includes(4)),{allowTotals:D}=(0,x.useMemo)((()=>(0,Et.A)({allowTotals:["2","4"]},(e=>j.forEach((t=>{var n,a;e.allowTotals[2].total++,null!=(n=u[t])&&n.includes(2)||e.allowTotals[2].current++,e.allowTotals[4].total++,null!=(a=u[t])&&a.includes(4)||e.allowTotals[4].current++}))))),[j,u]),M=(0,x.useMemo)((()=>Object.keys(c).filter((e=>{var t;return a.Gt.includes(e)&&!!Object.keys(null!=(t=c[e])?t:{}).length})).length),[c]),L=(0,x.useMemo)((()=>Object.assign({},l,{data:new re.w(Object.assign({},l.data.data[0],{artSet:(0,nt.K8)(a.Gt,(e=>(0,Ct.a9)(4)))}),void 0)})),[l]),I=(0,x.useCallback)((()=>{const e=Object.fromEntries(Object.entries(c).filter((([e])=>!a.Gt.includes(e))));d({conditional:e})}),[c,d]),R=(0,x.useCallback)(((e,t=!0)=>{const n=(0,nt.I8)(u);j.forEach((a=>{var i;t?n[a]=[...null!=(i=n[a])?i:[],e]:n[a]&&(n[a]=n[a].filter((t=>t!==e)))})),Z({artSetExclusion:n})}),[j,u,Z]);return(0,z.BX)(z.HY,{children:[(0,z.BX)(w.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.BX)(p.Z,{sx:{flexGrow:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:r(cn||(cn=wn`artSetConfig.title`))})}),(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(Y.Z,{children:[r(dn||(dn=wn`artSetConfig.setEffCond`))," ",(0,z.BX)(X.Z,{color:M?"success":"warning",children:[M," ",r("artSetConfig.enabled")]})]}),(0,z.BX)(Y.Z,{children:[r(un||(un=wn`sheet:2set`))," ",(0,z.BX)(X.Z,{color:"success",children:[D[2]," ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX))," ",r("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[r(hn||(hn=wn`sheet:4set`))," ",(0,z.BX)(X.Z,{color:"success",children:[D[4]," ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX))," ",r("artSetConfig.allowed")]})]}),(0,z.BX)(Y.Z,{children:[r(Zn||(Zn=wn`artSetConfig.2rainbow`))," ",(0,z.BX)(X.Z,{color:O?"success":"secondary",children:[O?(0,z.tZ)(Tt.Z,Object.assign({},pe.mX)):(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," ",O?r("artSetConfig.allowed"):"Excluded"]})]}),(0,z.BX)(Y.Z,{children:[r(pn||(pn=wn`artSetConfig.4rainbow`))," ",(0,z.BX)(X.Z,{color:A?"success":"secondary",children:[A?(0,z.tZ)(Tt.Z,Object.assign({},pe.mX)):(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," ",A?r("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,z.tZ)(g.Z,{onClick:v,disabled:e,color:"info",sx:{borderRadius:0,flexShrink:1,minWidth:40},children:(0,z.tZ)(Ot.Z,{})})]}),(0,z.tZ)(ae.Z,{open:m,onClose:y,children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:r(mn||(mn=wn`artSetConfig.title`))}),(0,z.tZ)(B.Z,{onClick:y})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:r(fn||(fn=wn`artSetConfig.modal.setCond.title`))})}),(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.BX)(X.Z,{color:M?"success":"warning",children:[M," ",r("artSetConfig.selected")]})}),(0,z.tZ)(g.Z,{size:"small",onClick:I,color:"error",startIcon:(0,z.tZ)(me.Z,{}),children:r(gn||(gn=wn`artSetConfig.modal.setCond.reset`))})]}),(0,z.tZ)(Y.Z,{children:r(xn||(xn=wn`artSetConfig.modal.setCond.text`))})]})}),(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.tZ)("strong",{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,z.BX)(te.Z,{color:"success",children:["Allowed",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluded",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))]})]})})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,z.tZ)("strong",{children:"A"})," is on-set, and ",(0,z.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," 2-Set"]})}),"would exclude 2-Set builds:",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]}),"and",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," 4-Set"]})}),"would exclude 4-Set builds:",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]}),"and",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," 3-Rainbow"]})}),"would exclude 2-Set + 3-Rainbow builds:",(0,z.BX)("strong",{children:["AA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRR"})]}),"and",(0,z.BX)("strong",{children:["AAA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))," 5-Rainbow"]})}),"would exclude full 5-Rainbow builds:",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,z.BX)(ue.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Sn,{allowTotal:D[2],setNum:2,setAllExclusion:R})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Sn,{allowTotal:D[4],setNum:4,setAllExclusion:R})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)("strong",{children:(0,z.BX)(b.cC,{t:r,i18nKey:"artSetConfig.alExRainbow",children:[(0,z.BX)(te.Z,{color:"success",children:["Allow ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,z.tZ)(Yt.Z,Object.assign({},pe.mX))]})," Rainbow Builds"]})})}),(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,xt.sL)(u,"rainbow",2)}),color:O?"success":"secondary",startIcon:O?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:O?(0,z.tZ)(Tt.Z,{}):(0,z.tZ)(Yt.Z,{}),children:r(bn||(bn=wn`artSetConfig.2rainbow`))}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>Z({artSetExclusion:(0,xt.sL)(u,"rainbow",4)}),color:A?"success":"secondary",startIcon:A?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:A?(0,z.tZ)(Tt.Z,{}):(0,z.tZ)(Yt.Z,{}),children:r(vn||(vn=wn`artSetConfig.4rainbow`))})]})]})})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:P.map((e=>(0,z.tZ)(kn,{setKey:e,fakeDataContextObj:L,slotCount:E[e]},e)))})]}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.tZ)(B.Z,{large:!0,onClick:y})})]})})]})}function Sn({allowTotal:e,setNum:t,setAllExclusion:n}){const{t:a}=(0,b.$G)(["page_character_optimize","sheet"]);return(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.BX)(Y.Z,{gutterBottom:!0,children:[(0,z.tZ)("strong",{children:a(`sheet:${t}set`)})," ",(0,z.BX)(X.Z,{color:"success",children:[e," ",(0,z.tZ)(Tt.Z,Object.assign({},pe.mX))," ",a("artSetConfig.allowed")]})]}),(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(g.Z,{fullWidth:!0,disabled:"0"!==e.charAt(0)&&-1===e.indexOf("/"),onClick:()=>n(t,!1),color:"success",startIcon:(0,z.tZ)(Tt.Z,{}),children:a(`artSetConfig.allowAll${t}set`)}),(0,z.tZ)(g.Z,{fullWidth:!0,disabled:"0"===e.charAt(0),onClick:()=>n(t,!0),color:"secondary",startIcon:(0,z.tZ)(Yt.Z,{}),children:a(`artSetConfig.excludeAll${t}set`)})]})]})})}function kn({setKey:e,fakeDataContextObj:t,slotCount:n}){var a,i;const{t:r}=(0,b.$G)("sheet"),{character:{key:l}}=(0,x.useContext)(_.K),{buildSetting:s}=Gt(l),{artSetExclusion:o}=s,c=null!=(a=null==o?void 0:o[e])?a:[],d=!c.includes(4),u=Xn(n),Z=(0,Qt.Sk)(e),m=(0,x.useMemo)((()=>d?Object.keys(Z.setEffects).filter((e=>{var t;return null==(t=Z.setEffects[e])?void 0:t.document.some((e=>"states"in e))})):[]),[Z.setEffects,d]);return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.BX)(w.Z,{sx:{height:"100%",opacity:u<2?"50%":void 0},children:[(0,z.BX)(h.Z,{className:`grad-${Z.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,z.tZ)(h.Z,{component:"img",src:(0,an.jU)(e),sx:{height:100,width:"auto",mx:-1}}),(0,z.BX)(h.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null!=(i=Z.name)?i:""}),(0,z.tZ)(h.Z,{children:(0,z.BX)(Y.Z,{variant:"subtitle1",children:[Z.rarity.map(((e,t)=>(0,z.BX)(h.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e," ",(0,z.tZ)(Jt.Z,{fontSize:"inherit"})," ",t<Z.rarity.length-1?"/ ":null]},e)))," ",(0,z.tZ)(pt.L,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(X.Z,{color:"success",children:r(yn||(yn=wn`2set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(nn.v,{ns:`artifact_${e}_gen`,key18:"setEffects.2"})}),(0,z.BX)(h.Z,{paddingTop:2,sx:{opacity:c.includes(4)?.6:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(X.Z,{color:"success",children:r(Cn||(Cn=wn`4set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(nn.v,{ns:`artifact_${e}_gen`,key18:"setEffects.4"})})]})]})})]})}),(0,z.tZ)(h.Z,{sx:{display:"flex",gap:1},children:Object.entries(n).map((([e,t])=>(0,z.tZ)(Y.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,z.BX)(X.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,z.tZ)(Dt.Z,{slotKey:e,iconProps:pe.mX})," ",t]})},e)))})]})]}),xt.Uu.includes(e)&&(0,z.tZ)(on,{setKey:e,buttonGroupSx:{".MuiButton-root":{borderRadius:0}}}),!!m.length&&(0,z.tZ)(K.R.Provider,{value:t,children:(0,z.tZ)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:m.map((t=>(0,z.tZ)(tn,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})})]})},e)}function Xn(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const _n=[0,4,8,12,16,20];function Kn({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:n}){const{t:a}=(0,b.$G)("page_character_optimize");return(0,z.tZ)(Zt.Z,{fullWidth:!0,color:e?"success":"primary",disabled:n,title:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no"),children:_n.map((e=>(0,z.tZ)(ot.Z,{onClick:()=>t(e),children:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no")},e)))})}let jn,Pn=e=>e;function En(){const{t:e}=(0,b.$G)("page_character_optimize"),{character:{bonusStats:t}}=(0,x.useContext)(_.K),{data:n}=(0,x.useContext)(K.R),a=Object.keys(t);if(!a.length)return null;const i=a.map((e=>n.get(ve.ri.customBonus[e])));return(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:e(jn||(jn=Pn`bonusStats.title`))})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:i.map((e=>(0,z.tZ)(Ie.JW,{node:e},JSON.stringify(e.info))))})]})}var On=n(38162);const Tn=(0,Be.ZP)("strong")({fontFamily:"monospace"}),An=(0,Be.ZP)(On.Z)((()=>({height:10,borderRadius:5})));function Dn({status:{type:e,tested:t,failed:n,skipped:a,total:i,startTime:r,finishTime:l},characterName:s}){const o=isFinite(i),c="inactive"!==e,d=i-a,u=(0,z.tZ)(Tn,{children:t.toLocaleString()}),h=(0,z.tZ)(Tn,{children:d.toLocaleString()}),Z=!!a&&(0,z.BX)("span",{children:["(",(0,z.tZ)("b",{children:(0,z.tZ)(Tn,{children:a.toLocaleString()})})," skipped)"]}),p=(0,z.tZ)(Tn,{children:(0,nt.e6)(Math.round((null!=l?l:performance.now())-(null!=r?r:NaN)))});let m,f="",g="";if(c)m=100*t/d,f=(0,z.BX)(Y.Z,{children:["Generating and testing ",u,o?(0,z.BX)(z.HY,{children:["/",h]}):void 0," build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Time elapsed: ",p]});else{if(!(t+a))return null;m=100,f=(0,z.BX)(Y.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Total duration: ",p]})}return(0,z.BX)(he.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[o&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:`${m.toFixed(1)}%`})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(An,{variant:o?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var Mn=n(74064),Ln=n(73673),In=n(99074),Rn=n(22499),Gn=n(54736),Nn=n(30538),zn=n(66615),Wn=n(75213),$n=n(47746),Vn=n(47591),Fn=n(69614),qn=n(70582);function Hn({characterKey:e}){const{gender:t}=(0,M.Z)();if(!e)return null;const n=(0,O.m)(e,t);return n?(0,z.tZ)(ut.Z,{placement:"right-end",title:(0,z.tZ)(Y.Z,{children:n.name}),children:(0,z.tZ)(G.Z,{characterKey:e,sideMargin:!0})}):null}var Un=n(26437);function Yn({statKey:e,disableIcon:t=!1}){return(0,z.BX)(h.Z,{component:"span",display:"flex",alignItems:"center",gap:1,children:[!t&&(0,z.tZ)(Ce.C,{statKey:e,iconProps:pe.mX}),(0,z.BX)("span",{children:[ye.ZP.get(e),ye.ZP.unit(e)]})]})}function Jn({statKey:e,disableIcon:t=!1}){return(0,z.tZ)(te.Z,{color:ye.ZP.getVariant(e),children:(0,z.tZ)(Yn,{statKey:e,disableIcon:t})})}var Qn=n(2218);function ea({artifactId:e,slotKey:t,mainStatAssumptionLevel:n=0,showLocation:i=!1,onClick:r,BGComponent:l=C.Z}){const s=(0,qn.Z)(e),{database:o}=(0,x.useContext)(T.t),c=(0,x.useCallback)((e=>(0,z.tZ)(Wn.Z,{onClick:r,sx:{height:"100%"},children:e})),[r]),d=(0,$n.Z)();if(!s)return(0,z.tZ)(l,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,z.tZ)(h.Z,{component:"img",src:Gn.CL.slot[t],sx:{width:"25%",height:"auto",opacity:.7}})});const{slotKey:u,rarity:Z,level:p,mainStatKey:m,substats:f,location:g}=s,b=Math.max(Math.min(n,4*Z),p),v=a.fR.find((e=>s.mainStatKey.includes(e))),y=v?(0,Vn.Fq)(d.palette[v].main,.6):(0,Vn.Fq)(d.palette.secondary.main,.6);return(0,z.tZ)(l,{sx:{height:"100%"},children:(0,z.tZ)(Un.Z,{condition:!!r,wrapper:c,children:(0,z.BX)(h.Z,{display:"flex",height:"100%",children:[(0,z.BX)(h.Z,{className:`grad-${Z}star`,sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(Qn.Z,{art:s,children:(0,z.tZ)(h.Z,{component:"img",src:(0,Gn.Hp)(s.setKey,u),sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(xe.Z,{size:"small",label:(0,z.tZ)("strong",{children:` +${p}`}),color:Fn.Z.levelVariant(p)}),i&&(0,z.tZ)(xe.Z,{size:"small",label:g?(0,z.tZ)(Hn,{characterKey:g&&o.chars.LocationToCharacterKey(g)}):(0,z.tZ)(zn.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(xe.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:y,p:1},icon:(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Jn,{statKey:m})}),disableInteractive:!0,children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Ce.C,{statKey:m,iconProps:{style:{padding:"4px"}}})})}),label:(0,z.tZ)(Y.Z,{sx:{mx:-.7},children:(0,z.tZ)(te.Z,{color:b!==p?"warning":void 0,children:(0,Nn.R1)(m,Z,b)})})})]}),(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:f.map(((e,t)=>(0,z.tZ)(ta,{stat:e},t+e.key)))})]})})})}function ta({stat:e}){var t,n;if(!e.value)return null;const a=null!=(t=null==(n=e.rolls)?void 0:n.length)?t:0,i=`roll${(0,nt.re)(a,1,6)}`,r=(0,nt.bf)(e.key);return(0,z.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:.5,alignItems:"center"},color:a?`${i}.main`:"error.main",component:"span",children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.key&&(0,z.tZ)(Jn,{statKey:e.key})}),disableInteractive:!0,children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Ce.C,{statKey:e.key,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)("span",{children:`${(0,Nn.Jj)(e.value,r)}${r}`})]})})}var na=n(42906);function aa(){const{data:e}=(0,x.useContext)(K.R),t=(0,x.useMemo)((()=>(0,ie.U)(e).filter((([,e])=>Object.values(e).some((e=>!e.isEmpty))))),[e]);return(0,z.tZ)(h.Z,{sx:{mr:-1,mb:-1},children:(0,z.tZ)(na.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:t.map((([e,t])=>(0,z.tZ)(ia,{displayNs:t,sectionKey:e},e)))})})}function ia({displayNs:e,sectionKey:t}){const n=(0,x.useContext)(ft),{data:a,oldData:i}=(0,x.useContext)(K.R),{database:r}=(0,x.useContext)(T.t),l=(0,x.useMemo)((()=>(0,ie.f)(a,t,r)),[r,a,t]),s=(0,x.useMemo)((()=>(0,nt.Ay)(e,((e,n)=>(0,Ct.UF)(["display",t,n])))),[e,t]);if(!l)return(0,z.tZ)(C.Z,{});const{title:o,icon:c,action:d}=l;return(0,z.BX)(C.Z,{children:[(0,z.tZ)(ee.Z,{avatar:c&&(0,z.tZ)(ne.Z,{size:2,src:c}),title:o,action:d&&(0,z.tZ)(X.Z,{children:d})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(Ie.lD,{sx:{m:0},children:Object.entries(e).map((([e,a])=>(0,z.tZ)(Ie.JW,{node:a,oldValue:i?i.get(s[e]).value:void 0,component:Ze.ZP,emphasize:JSON.stringify(n)===JSON.stringify([t,e])},e)))})]})}var ra=n(64401),la=n(51784),sa=n(30311),oa=n(61340);function ca({weaponId:e,showLocation:t=!1,onClick:n,BGComponent:a=C.Z}){const{database:i}=(0,x.useContext)(T.t),r=(0,sa.Z)(e),l=(null==r?void 0:r.key)&&(0,ra.ub)(r.key),s=(0,x.useCallback)((e=>(0,z.tZ)(Wn.Z,{sx:{height:"100%"},onClick:n,children:e})),[n]),o=(0,x.useMemo)((()=>l&&r&&(0,bt.mP)([l.data,(0,bt.v0)(r)])),[l,r]);if(!r||!l||!o)return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});const{refinement:c,location:d}=r;return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(Un.Z,{condition:!!n,wrapper:s,children:(0,z.BX)(h.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,z.BX)(h.Z,{className:`grad-${l.rarity}star`,sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,z.tZ)(oa.Z,{sheet:l,children:(0,z.tZ)(h.Z,{component:"img",src:(0,Gn.Aq)(r.key,r.ascension>=2),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(xe.Z,{size:"small",label:(0,z.tZ)("strong",{children:la.Z.getLevelString(r)}),color:"primary"}),t&&(0,z.tZ)(xe.Z,{size:"small",label:d?(0,z.tZ)(Hn,{characterKey:i.chars.LocationToCharacterKey(d)}):(0,z.tZ)(zn.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:l.hasRefinement&&(0,z.tZ)(xe.Z,{size:"small",color:"info",label:(0,z.BX)("strong",{children:["R",c]})})})]}),(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,z.tZ)(da,{node:o.get(ve.qH.weapon.main)}),(0,z.tZ)(da,{node:o.get(ve.qH.weapon.sub)})]})]})})})}function da({node:e}){return e.info.name?(0,z.tZ)(h.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.info.name}),disableInteractive:!0,children:(0,z.tZ)("span",{children:e.info.icon})}),(0,z.tZ)("span",{children:(0,re.p)(e)})]})}):null}var ua=n(30706),ha=n(5051);function Za({artifacts:e,currentlyEquipped:t=!1}){const n=(0,x.useMemo)((()=>e.filter((e=>e)).reduce(((e,t)=>(e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e)),{})),[e]);return(0,z.tZ)(z.HY,{children:Object.entries(n).sort((([e,t],[n,a])=>a.length-t.length)).map((([e,n])=>(0,z.tZ)(pa,{setKey:e,currentlyEquipped:t,slotarr:n},e)))})}function pa({setKey:e,currentlyEquipped:t=!1,slotarr:n}){var a;const i=(0,Qt.Sk)(e),r=n.length,l=Object.keys(i.setEffects).map((e=>parseInt(e))).filter((e=>e<=r));return(0,z.tZ)(h.Z,{children:(0,z.tZ)(ha.Z,{artifactSheet:i,numInSet:r,children:(0,z.tZ)(X.Z,{sx:{height:"100%"},color:t?"success":"primary",children:(0,z.BX)(Y.Z,{children:[n.map((e=>(0,z.tZ)(Dt.Z,{slotKey:e,iconProps:pe.mX},e)))," ",null!=(a=i.name)?a:"",l.map(((e,t)=>(0,z.tZ)(X.Z,{sx:{ml:.5},color:"success",children:e},""+e+t)))]})})})})}let ma,fa,ga=e=>e;function xa({label:e,compareBuild:t,extraButtonsRight:n,extraButtonsLeft:i,disabled:r}){const{character:{key:l,equippedArtifacts:s}}=(0,x.useContext)(_.K),{buildSetting:{mainStatAssumptionLevel:o,allowLocationsState:c}}=Gt(l),{database:d}=(0,x.useContext)(T.t),u=(0,x.useContext)(K.R),{data:m,oldData:f}=u,[b,v]=(0,x.useState)(void 0),y=(0,x.useCallback)((()=>v(void 0)),[v]),C=(0,x.useCallback)((()=>{if(!window.confirm("Do you want to equip this build to this character?"))return;const e=d.chars.get(l);if(!e)return;a.Ex.forEach((t=>{var n;const i=null==(n=m.get(ve.ri.art[t].id).value)?void 0:n.toString();if(i)d.arts.set(i,{location:(0,a.V7)(l)});else{const n=e.equippedArtifacts[t];n&&d.arts.get(n)&&d.arts.set(n,{location:""})}}));const t=m.get(ve.ri.weapon.id).value;t&&d.weapons.set(t,{location:(0,a.V7)(l)})}),[l,m,d]),B=(0,x.useMemo)((()=>{const e=Object.assign({},u);return t||(e.oldData=void 0),e}),[u,t]),S=(0,x.useMemo)((()=>Object.fromEntries(a.Ex.map((e=>{var t;return[e,null==(t=m.get(ve.ri.art[e].id).value)?void 0:t.toString()]})))),[m]),k=(0,x.useMemo)((()=>S&&Object.values(S).map((e=>d.arts.get(e))).filter((e=>e))),[S,d.arts]),j=(0,x.useMemo)((()=>a.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ea,{showLocation:!0,slotKey:e,artifactId:S[e],mainStatAssumptionLevel:o,onClick:()=>{const t=s[e],n=S[e];v({oldId:t!==n?t:void 0,newId:n})}})},e)))),[v,s,o,S]);if(!f)return null;const P=a.Ex.every((e=>{var t;return S[e]===(null==(t=f.get(ve.ri.art[e].id).value)?void 0:t.toString())}))&&m.get(ve.ri.weapon.id).value===f.get(ve.ri.weapon.id).value;return(0,z.tZ)(w.Z,{children:(0,z.BX)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:[b&&(0,z.tZ)(ba,{newOld:b,mainStatAssumptionLevel:o,onClose:y,allowLocationsState:c}),(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==e&&(0,z.tZ)(X.Z,{color:"info",children:(0,z.tZ)(Y.Z,{children:(0,z.BX)("strong",{children:[e,P?" (Equipped)":""]})})}),(0,z.tZ)(Za,{artifacts:k,currentlyEquipped:P}),(0,z.tZ)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),i,(0,z.tZ)(g.Z,{size:"small",color:"success",onClick:C,disabled:r||P,startIcon:(0,z.tZ)(Mn.Z,{}),children:"Equip Build"}),n]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ca,{showLocation:!0,weaponId:m.get(ve.ri.weapon.id).value})}),j]}),(0,z.tZ)(K.R.Provider,{value:B,children:(0,z.tZ)(aa,{})})]})]})})}function ba({newOld:{newId:e,oldId:t},mainStatAssumptionLevel:n,onClose:i,allowLocationsState:r}){var l,s;const{database:o}=(0,x.useContext)(T.t),{character:{key:c}}=(0,x.useContext)(_.K),d=(0,x.useCallback)((()=>{window.confirm("Do you want to equip this artifact to this character?")&&(o.arts.set(e,{location:(0,a.V7)(c)}),i())}),[e,o,c,i]),u=null!=(l=null==(s=o.arts.get(e))?void 0:s.location)?l:"",Z=(0,qn.Z)(e);return(0,z.tZ)(ae.Z,{open:!!e,onClose:i,containerProps:{maxWidth:t?"md":"xs"},children:(0,z.tZ)(C.Z,{children:(0,z.BX)(p.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2},children:[t&&(0,z.tZ)(h.Z,{minWidth:320,children:(0,z.tZ)(ua.Z,{artifactId:t,mainStatAssumptionLevel:n,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(va,{id:t})})}),t&&(0,z.tZ)(h.Z,{display:"flex",flexGrow:1}),t&&(0,z.tZ)(h.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,z.tZ)(g.Z,{onClick:d,sx:{display:"flex"},children:(0,z.tZ)(Ln.Z,{sx:{fontSize:40}})})}),t&&(0,z.tZ)(h.Z,{display:"flex",flexGrow:1}),(0,z.BX)(h.Z,{minWidth:320,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(ua.Z,{artifactId:e,mainStatAssumptionLevel:n,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(va,{id:e})}),u&&u!==(0,a.V7)(c)&&"all"!==r&&(0,z.tZ)(ya,{locationKey:u}),Z&&xt.Uu.includes(Z.setKey)&&(0,z.tZ)(on,{setKey:Z.setKey})]})]})})})}function va({id:e}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:n}}=(0,x.useContext)(_.K),{buildSetting:{artExclusion:a},buildSettingDispatch:i}=Gt(n),r=a.includes(e),l=(0,x.useCallback)((()=>i({artExclusion:(0,nt.nh)(a,e)})),[e,a,i]);return(0,z.tZ)(ut.Z,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{children:t(ma||(ma=ga`excludeArt.excludeArtifactTip`))}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(te.Z,{color:r?"error":"success",children:t(r?"excludeArt.excluded":"excludeArt.included")})})]}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{onClick:l,color:r?"error":"success",size:"small",children:r?(0,z.tZ)(Yt.Z,{}):(0,z.tZ)(Tt.Z,{})})})}function ya({locationKey:e}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:n}}=(0,x.useContext)(_.K),{database:a}=(0,x.useContext)(T.t),i=(0,O.m)(a.chars.LocationToCharacterKey(e)),{buildSetting:{excludedLocations:r},buildSettingDispatch:l}=Gt(n),s=r.includes(e),o=(0,x.useCallback)((()=>l({excludedLocations:(0,nt.nh)(r,e)})),[e,r,l]);return(0,z.tZ)(g.Z,{onClick:o,color:s?"secondary":"success",size:"small",startIcon:s?(0,z.tZ)(Rn.Z,{}):(0,z.tZ)(In.Z,{}),children:(0,z.BX)("span",{children:[t(fa||(fa=ga`excludeChar.allowEquip`))," ",(0,z.tZ)("strong",{children:i.name})]})})}var Ca=n(68164),wa=n(66510),Ba=n(61660),Sa=n(22443),ka=n(55484),Xa=n(25556),_a=n(81224),Ka=n(3131),ja=n(47857),Pa=n(55734),Ea=n(63004),Oa=n(36197);function Ta(e){const{database:t}=(0,x.useContext)(T.t),[n,a]=(0,x.useState)((()=>t.buildResult.get(e)));(0,x.useEffect)((()=>a(t.buildResult.get(e))),[t,e]),(0,x.useEffect)((()=>t.buildResult.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildResult:n,buildResultDispatch:(0,x.useCallback)((n=>e&&t.buildResult.set(e,n)),[e,t])}}var Aa=n(6875);function Da({cx:e,cy:t,payload:n,selectedPoint:a,radiusSelected:i=6,radiusUnselected:r=3,colorSelected:l="red",colorUnselected:s,shape:o="circle"}){if(!e||!t||!n)return null;const c=a&&a.x===n.x&&a.y===n.y;return(0,z.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":n.x,"data-y-value":n.y,"data-radius":c?r:i,children:c?(0,z.BX)(z.HY,{children:[(0,z.tZ)(Ma,{id:"customShapeSelected",shape:o,cx:e,cy:t,r:i/2,fill:l}),(0,z.tZ)(Ma,{id:"customShapeBorder",shape:o,cx:e,cy:t,r:i,fill:"none",stroke:l})]}):(0,z.tZ)(Ma,{id:"customShapeUnselected",shape:o,cx:e,cy:t,r,fill:s})})}function Ma({shape:e,id:t,cx:n,cy:a,r:i,fill:r,stroke:l}){switch(e){case"circle":return(0,z.tZ)("circle",{id:t,cx:n,cy:a,r:i,fill:r,stroke:l});case"square":return(0,z.tZ)("rect",{id:t,x:n-i,y:a-i,width:2*i,height:2*i,fill:r,stroke:l});case"diamond":return(0,z.tZ)("polygon",{id:t,points:`${n},${a+2.5*i} ${n+1.5*i},${a} ${n},${a-2.5*i} ${n-1.5*i},${a}`,fill:r,stroke:l})}}var La=n(99118),Ia=n(45390);const Ra=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function Ga(e){let{xLabel:t,xUnit:n,yLabel:i,yUnit:r,selectedPoint:l,setSelectedPoint:s,addBuildToList:o}=e,c=(0,we.Z)(e,Ra);const{database:d}=(0,x.useContext)(T.t),{data:u}=(0,x.useContext)(K.R),{t:h}=(0,b.$G)("page_character_optimize"),m=(0,x.useMemo)((()=>l&&l.artifactIds&&Object.fromEntries(l.artifactIds.map((e=>{const t=d.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[d.arts,l]),f=(0,x.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||s(void 0)}),[s]),v=m&&a.Ex.every((e=>{var t,n;return(null==(t=m[e])?void 0:t.id)===(null==(n=u.get(ve.qH.art[e].id).value)?void 0:n.toString())})),y=(0,x.useMemo)((()=>void 0!==(null==l?void 0:l.generBuildNumber)&&`#${null==l?void 0:l.generBuildNumber}`),[l]),w=(0,x.useMemo)((()=>void 0!==(null==l?void 0:l.graphBuildNumber)&&(0,z.BX)(b.cC,{t:h,i18nKey:"graphBuildLabel",count:null==l?void 0:l.graphBuildNumber,children:["Graph #",{count:(null==l?void 0:l.graphBuildNumber)+1}]})),[l,h]);return c.active&&l?(0,z.tZ)(La.Z,{onClickAway:f,children:(0,z.tZ)(C.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,z.tZ)(p.Z,{children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(de.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,z.BX)(de.Z,{spacing:.5,flexGrow:99,children:[v&&(0,z.tZ)(X.Z,{color:"info",children:(0,z.tZ)("strong",{children:h("currentlyEquippedBuild")})}),y&&(0,z.tZ)(X.Z,{color:"info",children:y}),w&&(0,z.tZ)(X.Z,{color:"info",children:w}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{width:300,height:50}),children:(0,z.tZ)(Za,{artifacts:Object.values(m),currentlyEquipped:v})})]}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(B.Z,{onClick:()=>s(void 0)})]}),(0,z.tZ)(ue.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:a.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{width:75,height:75}),children:(0,z.tZ)(Ia.Z,{artifactObj:m[e],slotKey:e})})},e)))}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:t}),":"," ",(0,nt.EC)("%"===n?l.x/100:l.x,n)]}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:i}),":"," ",(0,nt.EC)("%"===r?l.y/100:l.y,r)]}),(0,z.tZ)(ut.Z,{title:l.highlighted?h("tcGraph.buildAlreadyInList"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{sx:{width:"100%"},disabled:void 0!==(null==l?void 0:l.graphBuildNumber),color:"info",onClick:()=>o(l.artifactIds),children:h("addBuildToList")})})})]})})})}):null}class EnhancedPoint{constructor(e,t,n){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.generBuildNumber=void 0,this.graphBuildNumber=void 0,this.x=e,this.trueY=t,this.artifactIds=n}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let Na,za,Wa,$a,Va,Fa,qa,Ha=e=>e;function Ua({plotBase:e,setPlotBase:t,disabled:n=!1,showTooltip:r=!1}){const{t:l}=(0,b.$G)(["page_character_optimize","ui"]),{data:s}=(0,x.useContext)(K.R),{chartData:o}=(0,x.useContext)(P),[c,d]=(0,x.useState)(!1),[u,h]=(0,x.useState)(!0),{graphBuilds:Z}=(0,x.useContext)(P),{character:{key:m}}=(0,x.useContext)(_.K),{buildResult:{builds:f}}=Ta(m),[v,y]=(0,x.useState)(-1/0),[B,S]=(0,x.useState)(1/0),k=(0,x.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[n,a]=t;y(n),S(a)}),[y,S]);(0,x.useEffect)((()=>{y(-1/0),S(1/0)}),[o]);const{displayData:X,downloadData:j,sliderMin:E,sliderMax:O}=(0,x.useMemo)((()=>{var e,t;if(!o)return{displayData:null,downloadData:null};let n=1/0,i=-1/0;const r=a.Ex.map((e=>{var t;return null!=(t=null==s?void 0:s.get(ve.qH.art[e].id).value)?t:""})),l=o.data.map((({value:e,plot:t,artifactIds:a})=>{if(void 0===t)return null;t<n&&(n=t),t>i&&(i=t);const l=new EnhancedPoint(t,e,a),s=(0,nt.K8)(a,(e=>!0));r.every((e=>s[e]))&&(l.current=e,l.y=void 0);const o=null==Z?void 0:Z.findIndex((e=>e.every((e=>s[e]))));void 0!==o&&-1!==o&&(void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.graphBuildNumber=o+1);const c=f.findIndex((e=>e.every((e=>s[e]))));return-1!==c&&(void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.generBuildNumber=c+1),l})).filter((e=>null!==e)).sort(((e,t)=>e.x-t.x)),c=[];for(const a of l){let e;for(;e=c.pop();)if(e.y>a.y){c.push(e);break}c.push(a)}(null==(e=c[0])?void 0:e.x)!==(null==(t=l[0])?void 0:t.x)&&(l[0].min=c[0].y),c.forEach((e=>{e.min=e.y}));const d={minimum:c.map((e=>[e.x,e.y])),allData:l.map((e=>[e.x,e.y]))};return{displayData:l.filter((e=>e&&e.x>=v&&e.x<=B)),downloadData:d,sliderMin:n,sliderMax:i}}),[o,f,s,Z,v,B]),T=e&&(0,nt.Hm)(null==s?void 0:s.getDisplay(),e),A=l(e&&(!T||T.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:l(Na||(Na=Ha`tcGraph.vs`))})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(ut.Z,{placement:"top",title:r?l("page_character_optimize:selectTargetFirst"):"",children:(0,z.tZ)("span",{children:(0,z.tZ)(Aa.Z,{optimizationTarget:e,setTarget:e=>t(e),defaultText:A,disabled:n})})})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(ut.Z,{title:e?l("ui:reset"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{color:"error",onClick:()=>t(void 0),disabled:!e||n,children:(0,z.tZ)(me.Z,{})})})})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(pt.Z,{placement:"top",title:l("page_character_optimize:tcGraph.desc")})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{size:"small",startIcon:u?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:u?"success":"secondary",onClick:()=>h(!u),children:l(za||(za=Ha`tcGraph.showStatThr`))})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{size:"small",color:"info",startIcon:(0,z.tZ)(Ca.Z,{}),onClick:()=>d(!c),children:l(Wa||(Wa=Ha`tcGraph.downloadData`))})})]})}),X&&X.length&&(0,z.tZ)(q.Z,{}),o&&X&&!!X.length&&(0,z.BX)(p.Z,{children:[(0,z.tZ)(be.Z,{in:!!j&&c,children:(0,z.tZ)(C.Z,{sx:{mb:2},children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{children:"Min Data"}),(0,z.tZ)(i.TU,{value:JSON.stringify(null==j?void 0:j.minimum)}),(0,z.tZ)(Y.Z,{children:"All Data"}),(0,z.tZ)(i.TU,{value:JSON.stringify(null==j?void 0:j.allData)})]})})}),(0,z.tZ)(ti,{displayData:X,plotNode:o.plotNode,valueNode:o.valueNode,showMin:u}),X.length>1&&(0,z.tZ)(wa.ZP,{marks:!0,value:[v,B],onChange:k,onChangeCommitted:k,min:E,max:O,step:(O-E)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,n;return(0,nt.EC)("%"===(null==(t=o.plotNode.info)?void 0:t.unit)?e/100:e,null==(n=o.plotNode.info)?void 0:n.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const Ya="#8884d8",Ja="cyan",Qa="#46a046",ei="#ff7300";function ti({displayData:e,plotNode:t,valueNode:n,showMin:a}){var i,r,l,s;const{graphBuilds:o,setGraphBuilds:c}=(0,x.useContext)(P),{t:d}=(0,b.$G)("page_character_optimize"),[u,h]=(0,x.useState)(),Z=(0,x.useCallback)((e=>{c([...null!=o?o:[],e]),h(void 0)}),[c,o]),p=(0,x.useCallback)((t=>{t&&t.chartX&&t.chartY&&h(function(e,t,n,a){const i=Array.from(document.querySelectorAll(".custom-dot")).reduce(((n,a)=>{const{chartX:i,chartY:r}=n.dataset,l=Math.sqrt((e-i)**2+(t-r)**2),{chartX:s,chartY:o}=a.dataset;return l<=Math.sqrt((e-s)**2+(t-o)**2)?n:a})).dataset;return Math.sqrt((e-i.chartX)**2+(t-i.chartY)**2)<n?a.find((e=>e.x===+i.xValue&&e.y===+i.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[h,e]),m=ni(t,d),f=ni(n,d);return(0,z.tZ)(Ba.h,{width:"100%",height:600,children:(0,z.BX)(Sa.c,{id:"chartContainer",data:e,onClick:p,style:{cursor:"pointer"},children:[(0,z.tZ)(ka.q,{strokeDasharray:"3 3"}),(0,z.tZ)(Xa.K,{dataKey:"x",scale:"linear",unit:null==(i=t.info)?void 0:i.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,z.tZ)(_a._,{fill:"white",dy:10,children:m}),height:50}),(0,z.tZ)(Ka.B,{name:"DMG",domain:["auto","auto"],unit:null==(r=n.info)?void 0:r.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,z.tZ)(_a._,{fill:"white",angle:-90,dx:-40,children:f}),width:100}),(0,z.tZ)(ja.u,{content:(0,z.tZ)(Ga,{xLabel:m,xUnit:null==(l=t.info)?void 0:l.unit,yLabel:f,yUnit:null==(s=n.info)?void 0:s.unit,selectedPoint:u,setSelectedPoint:h,addBuildToList:Z}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,z.tZ)(Pa.D,{payload:[...a?[{id:"min",value:d($a||($a=Ha`tcGraph.statReqThr`)),type:"line",color:ei}]:[],{id:"trueY",value:d(Va||(Va=Ha`tcGraph.generatedBuilds`)),type:"circle",color:Ya},{id:"highlighted",value:d(Fa||(Fa=Ha`tcGraph.highlightedBuilds`)),type:"square",color:Ja},{id:"current",value:d(qa||(qa=Ha`tcGraph.currentBuild`)),type:"diamond",color:Qa}]}),a&&(0,z.tZ)(Ea.x,{dataKey:"min",stroke:ei,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,z.tZ)(Oa.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,z.tZ)(Da,{selectedPoint:u,colorUnselected:Ya})}),(0,z.tZ)(Oa.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,z.tZ)(Da,{shape:"square",selectedPoint:u,colorUnselected:Ja})}),(0,z.tZ)(Oa.b,{dataKey:"current",isAnimationActive:!1,shape:(0,z.tZ)(Da,{shape:"diamond",selectedPoint:u,colorUnselected:Qa})})]})})}function ni(e,t){var n,a,i,r,l;return"string"==typeof(null==(n=e.info)?void 0:n.name)?e.info.name:`${t(`${null==(a=e.info)||null==(a=a.name)?void 0:a.props.ns}:${null==(i=e.info)||null==(i=i.name)?void 0:i.props.key18}`)}${null!=(r=e.info)&&r.textSuffix?` ${null==(l=e.info)?void 0:l.textSuffix}`:""}`}var ai=n(92760),ii=n(22537),ri=n(15015);let li,si,oi,ci,di,ui=e=>e;function hi({disabled:e=!1,excludedTotal:t}){const{t:n}=(0,b.$G)("page_character_optimize"),{character:{key:a}}=(0,x.useContext)(_.K),{buildSetting:{artExclusion:r,useExcludedArts:l},buildSettingDispatch:s}=Gt(a),[o,c,d]=(0,i.aV)(!1),u=r.length,[Z,m,f]=(0,i.aV)(!1),v=(0,x.useCallback)((e=>{s({artExclusion:[...r,e],useExcludedArts:!1})}),[s,r]),y=(0,x.useCallback)((e=>{s({artExclusion:r.filter((t=>t!==e)),useExcludedArts:!1})}),[s,r]),S=(0,x.useCallback)((()=>s({useExcludedArts:!l})),[s,l]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ae.Z,{open:o,onClose:d,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(Y.Z,{variant:"h6",children:n(li||(li=ui`excludeArt.title_exclude`))}),(0,z.tZ)(pt.Z,{title:(0,z.tZ)(Y.Z,{children:n(si||(si=ui`excludeArt.title_tooltip`))})}),(0,z.tZ)(h.Z,{flexGrow:1}),(0,z.tZ)(B.Z,{onClick:d,size:"small"})]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(mi,{show:Z,onClose:f,onSelect:v,artExclusion:r}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:m,color:"info",sx:{mb:1},startIcon:(0,z.tZ)(ai.Z,{}),children:n(oi||(oi=ui`excludeArt.addExc`))}),!!u&&(0,z.tZ)(w.Z,{sx:{mb:1},children:(0,z.tZ)(Y.Z,{textAlign:"center",children:n(ci||(ci=ui`excludeArt.deSelectExc`))})}),(0,z.tZ)(ue.ZP,{container:!0,columns:{xs:3,md:5,lg:6,xl:8},spacing:1,children:r.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ea,{artifactId:e,slotKey:"flower",BGComponent:w.Z,onClick:()=>y(e),showLocation:!0})},e)))})]})]})}),(0,z.BX)(_e.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.tZ)(g.Z,{onClick:S,disabled:e||!u,startIcon:l?(0,z.tZ)(Rn.Z,{}):(0,z.tZ)(In.Z,{}),color:l?"secondary":"success",sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(h.Z,{children:n("excludeArt.button_txt")}),(0,z.tZ)(X.Z,{sx:{whiteSpace:"normal"},color:u?l?"warning":"primary":"secondary",children:l?(0,z.BX)(b.cC,{t:n,i18nKey:"excludeArt.usingNum",children:["Using ",{totalStr:t}," excluded artifacts"]}):(0,z.BX)(b.cC,{t:n,i18nKey:"excludeArt.excNum",count:u,children:[{count:u}," artifacts are excluded"]})})]})}),(0,z.tZ)(g.Z,{color:"info",onClick:c,disabled:e,sx:{flexShrink:1},children:(0,z.tZ)(Ot.Z,{})})]})]})}const Zi={xs:6,sm:6,md:9,lg:12,xl:12},pi=(e,t)=>Object.assign({},e,t);function mi({onSelect:e,show:t,onClose:n,artExclusion:a}){const{t:r}=(0,b.$G)("page_character_optimize"),{database:l}=(0,x.useContext)(T.t),s=(0,x.useCallback)((t=>{e(t),n()}),[e,n]),[o,c]=(0,x.useReducer)(pi,(0,ri.Af)()),[d,u]=(0,i.NW)();(0,x.useEffect)((()=>l.arts.followAny(u)),[l,u]);const m=(0,i.JT)(),f=(0,x.useMemo)((()=>(0,ri.EM)()),[]),g=(0,x.useMemo)((()=>{const e=(0,nt.CZ)(o,f);return d&&l.arts.values.filter(e).map((e=>e.id)).filter((e=>!a.includes(e))).slice(0,Zi[m])}),[d,l,f,o,m,a]);return(0,z.tZ)(ae.Z,{open:t,onClose:n,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:r(di||(di=ui`excludeArt.selExc`))}),(0,z.tZ)(B.Z,{onClick:n})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(ii.default,{filterOption:o,filterOptionDispatch:c,filteredIds:g})}),(0,z.tZ)(h.Z,{mt:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:g.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ua.Z,{artifactId:e,onClick:s})},e)))})})})]})]})})}var fi=n(40067),gi=n(61851);const xi=["sands","goblet","circlet"];function bi({disabled:e=!1,filteredArtIdMap:t}){const{t:n}=(0,b.$G)("artifact"),{character:{key:i}}=(0,x.useContext)(_.K),{buildSetting:{mainStatKeys:r},buildSettingDispatch:l}=Gt(i),{database:s}=(0,x.useContext)(T.t),{mainStatSlotTots:o,slotTots:c}=(0,x.useMemo)((()=>{const e={flowerMainStatTots:a.x1.flower.stats,plumeMainStatTots:a.x1.plume.stats,sandsMainStatTots:a.x1.sands.stats,gobletMainStatTots:a.x1.goblet.stats,circletMainStatTots:a.x1.circlet.stats,slotTots:xi},n=(0,Et.A)(e,(e=>Object.entries(s.arts.data).forEach((([n,a])=>{const{slotKey:i,mainStatKey:r}=a;xi.includes(i)&&(e.slotTots[i].total++,t[n]&&e.slotTots[i].current++),e[`${i}MainStatTots`][r].total++,t[n]&&e[`${i}MainStatTots`][r].current++}))));return{mainStatSlotTots:{flower:n.flowerMainStatTots,plume:n.plumeMainStatTots,sands:n.sandsMainStatTots,goblet:n.gobletMainStatTots,circlet:n.circletMainStatTots},slotTots:n.slotTots}}),[s,t]);return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",children:[(0,z.tZ)(q.Z,{}),(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.flower")}),children:(0,z.tZ)(fi.pv,{fontSize:"inherit"})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.BX)(X.Z,{color:"info",children:[(0,z.tZ)(fi.If,Object.assign({},pe.mX))," ",o.flower.hp]})})]})}),(0,z.tZ)(q.Z,{orientation:"vertical",flexItem:!0}),(0,z.tZ)(p.Z,{sx:{flexGrow:1},children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.plume")}),children:(0,z.tZ)(fi.QA,{fontSize:"inherit"})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.BX)(X.Z,{color:"info",children:[(0,z.tZ)(fi._B,Object.assign({},pe.mX))," ",o.plume.atk]})})]})})]}),xi.map((t=>{const i=r[t],s=a.x1[t].stats,d=(0,gi.X)([...s]);return(0,z.BX)(h.Z,{children:[(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{sx:{pt:1,pb:1},children:[(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n(`slotName.${t}`)}),children:(0,z.tZ)(h.Z,{lineHeight:0,children:(0,z.tZ)(Dt.Z,{slotKey:t,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)(h.Z,{flexGrow:1,children:(0,z.tZ)(X.Z,{color:"info",children:c[t]})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:s.map(((n,s)=>{const c=a.fR.find((e=>n.includes(e))),u=i.includes(n)?null!=c?c:"success":"secondary";return(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,xs:s<3&&"goblet"!==t||"goblet"===t?4:void 0,children:(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:(0,z.tZ)(Jn,{statKey:n})})}),disableInteractive:!0,children:(0,z.tZ)(g.Z,{fullWidth:!0,size:"small",color:u,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0},startIcon:(0,z.tZ)(Ce.C,{statKey:n}),onClick:()=>l({mainStatKeys:Object.assign({},r,{[t]:d(i,n)})}),children:o[t][n]})})},n)}))})]})]},t)}))]})}var vi=n(11845);function yi({statFilters:e,setStatFilters:t,disabled:n=!1}){const a=(0,x.useCallback)(((n,a,i)=>{var r;const l=Object.assign({},e),s=JSON.stringify(a),o=a?[...e[s]]:void 0,c=JSON.stringify(n),d=[...null!=(r=e[c])?r:[]];void 0!==i&&o?d.push(o[i]):d.push({value:0,disabled:!1}),l[c]=d,void 0!==i&&o&&(o.splice(i,1),o.length?l[s]=o:delete l[s]),t(Object.assign({},l))}),[t,e]),i=(0,x.useCallback)(((n,a)=>{const i=Object.assign({},e),r=JSON.stringify(n),l=[...e[r]];l.splice(a,1),l.length?i[r]=l:delete i[r],t(Object.assign({},i))}),[t,e]),r=(0,x.useCallback)(((n,a,i)=>{const r=Object.assign({},e),l=JSON.stringify(n),s=[...e[l]];s[a]=Object.assign({},s[a],{value:i}),r[l]=s,t(Object.assign({},r))}),[t,e]),l=(0,x.useCallback)(((n,a,i)=>{const r=Object.assign({},e),l=JSON.stringify(n),s=[...e[l]];s[a]=Object.assign({},s[a],{disabled:i}),r[l]=s,t(Object.assign({},r))}),[t,e]);return(0,z.BX)(z.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,z.tZ)(Ci,{path:JSON.parse(e),setting:t,index:s,setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:n},e+s))))),(0,z.tZ)(Ci,{setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:n})]})}function Ci({path:e,setting:t,index:n,setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:s}){var o;const{t:c}=(0,b.$G)("page_character_optimize"),{data:d}=(0,x.useContext)(K.R),u=(0,x.useCallback)((t=>e&&void 0!==n&&r(e,n,null!=t?t:0)),[r,e,n]),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0},Z=(0,vi.Hm)(d.getDisplay(),null!=e?e:[]),p="%"===(null==Z||null==(o=Z.info)?void 0:o.unit);return(0,z.BX)(_e.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==n&&(0,z.tZ)(g.Z,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>l(e,n,!t.disabled),disabled:s,children:t.disabled?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{})}),(0,z.tZ)(Aa.Z,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>a(t,e,n),defaultText:c("targetSelector.selectBuildTarget")}),(0,z.tZ)(Ke.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,z.tZ)(Ke.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:u,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!e&&void 0!==n&&(0,z.tZ)(g.Z,{sx:h,color:"error",onClick:()=>i(e,n),disabled:s,children:(0,z.tZ)(it.Z,{fontSize:"small"})})]})}let wi,Bi,Si=e=>e;function ki({disabled:e=!1}){const{t}=(0,b.$G)("page_character_optimize"),{character:{key:n}}=(0,x.useContext)(_.K),{buildSetting:{statFilters:a},buildSettingDispatch:i}=Gt(n),r=(0,x.useCallback)((e=>i({statFilters:e})),[i]);return(0,z.tZ)(h.Z,{children:(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:(0,z.BX)(h.Z,{display:"flex",justifyContent:"space-between",children:[(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:t(wi||(wi=Si`constraintFilter.title`))}),(0,z.tZ)(pt.Z,{title:(0,z.tZ)(Y.Z,{children:t(Bi||(Bi=Si`constraintFilter.tooltip`))})})]})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,z.tZ)(yi,{statFilters:a,setStatFilters:r,disabled:e})})]})})}const Xi=(0,Ct.yY)((0,nt.I8)({dyn:Object.assign({},ve.qH.art,ve.qH.artSet)})),_i={art:(0,nt.K8)([...a.rW,...a._m],(e=>Xi.dyn[e])),artSet:(0,nt.Ay)(ve.qH.artSet,((e,t)=>Xi.dyn[t]))};let Ki,ji,Pi,Ei,Oi,Ti,Ai,Di=e=>e;const Mi=new Audio("notification.mp3");function Li(){var e,t;const{t:n}=(0,b.$G)("page_character_optimize"),{character:{key:r,compareData:l}}=(0,x.useContext)(_.K),{database:s}=(0,x.useContext)(T.t),{setChartData:c,graphBuilds:d,setGraphBuilds:u}=(0,x.useContext)(P),{gender:Z}=(0,M.Z)(),[m,f]=(0,x.useState)(!1),v=(0,x.useRef)(!1);(0,x.useEffect)((()=>{v.current=m}),[m]);const[C,B]=(0,x.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),k="inactive"!==C.type,[j,E]=(0,i.NW)(),[{threads:O=gt.g},A]=(0,x.useState)(s.displayOptimize.get());(0,x.useEffect)((()=>s.displayOptimize.follow(((e,t)=>A(t)))),[s,A]);const I=O>gt.g?gt.g:O,R=(0,x.useCallback)((e=>s.displayOptimize.set({threads:e})),[s]),G=(0,D.Z)(r),W=(0,N.Z)();(0,x.useEffect)((()=>{B({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[r]);const $=(0,x.useMemo)((()=>!s.arts.values.length),[s]),{buildSetting:V,buildSettingDispatch:F}=Gt(r),{plotBase:H,optimizationTarget:U,mainStatAssumptionLevel:J,allowPartial:Q,maxBuildsToShow:ee,levelLow:te,levelHigh:ne}=V,{buildResult:{builds:ae,buildDate:ie},buildResultDispatch:re}=Ta(r),le=(0,L.Z)(r,J),{characterSheet:se,target:oe}=null!=(e=null==le?void 0:le[r])?e:{},ce=U&&(0,nt.Hm)(null==oe?void 0:oe.getDisplay(),U),de=["xs","sm"].includes((0,i.JT)());(0,x.useEffect)((()=>s.arts.followAny(E)),[E,s]);const Ze=(0,x.useDeferredValue)(j),pe=(0,x.useDeferredValue)(V),me=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:t,artExclusion:n,levelLow:i,levelHigh:l,allowLocationsState:o,useExcludedArts:c}=Ze&&pe;return s.arts.values.filter((s=>{if(!c&&n.includes(s.id))return!1;if(s.level<i)return!1;if(s.level>l)return!1;const d=e[s.slotKey];if(null!=d&&d.length&&!d.includes(s.mainStatKey))return!1;const u=(0,a.V7)(r),h="unequippedOnly"===o&&s.location&&s.location!==u,Z="customList"===o&&s.location&&s.location!==u&&t.includes(s.location);return!h&&!Z}))}),[s,r,Ze,pe]),xe=(0,x.useMemo)((()=>(0,nt.K8)(me.map((({id:e})=>e)),(e=>!0))),[me]),{levelTotal:be,allowListTotal:ve,excludedTotal:ye}=(0,x.useMemo)((()=>(0,Et.A)({levelTotal:["in"],allowListTotal:["in"],excludedTotal:["in"]},(e=>Object.entries(s.arts.data).forEach((([t,n])=>{const{level:i,location:l}=n,{levelLow:s,levelHigh:o,excludedLocations:c,allowLocationsState:d,artExclusion:u}=Ze&&pe;i>=s&&i<=o&&(e.levelTotal.in.total++,xe[t]&&e.levelTotal.in.current++);const h=(0,a.V7)(r),Z="all"===d&&l&&l!==h,p="customList"===d&&l&&l!==h&&!c.includes(l);(Z||p)&&(e.allowListTotal.in.total++,xe[t]&&e.allowListTotal.in.current++),u.includes(t)&&(e.excludedTotal.in.total++,xe[t]&&e.excludedTotal.in.current++)}))))),[r,s.arts.data,Ze,pe,xe]),Ce=(0,x.useRef)(!0);(0,x.useEffect)((()=>{const e=()=>Ce.current=!0,t=()=>Ce.current=!1;return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[Ce]);const we=(0,x.useRef)((()=>{}));(0,x.useEffect)((()=>()=>we.current()),[]);const Be=function(){const[,e]=(0,x.useState)();return(0,x.useCallback)((t=>{e((()=>{throw t}))}),[])}(),Se=(0,x.useCallback)((async()=>{var e,t,i;const{artSetExclusion:l,plotBase:o,statFilters:d,optimizationTarget:u,mainStatAssumptionLevel:h,allowPartial:p,maxBuildsToShow:m}=V;if(!r||!u)return;const f=function(e,t,n){const i={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},r=new Set;for(const l of e){const e=(0,Nn.Bv)(l.mainStatKey,l.rarity,Math.max(Math.min(t,a.F7[l.rarity]),l.level)),n={id:l.id,set:l.setKey,values:Object.assign({[l.setKey]:1,[l.mainStatKey]:l.mainStatKey.endsWith("_")?e/100:e},Object.fromEntries(l.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]))))};delete n.values[""],i.values[l.slotKey].push(n),Object.keys(n.values).forEach((e=>r.add(e)))}if(i.base=(0,nt.K8)([...r],(e=>0)),n)for(const a of Object.values(i.values))a.push({id:"",values:{}});return i}(me,h,p),g=(0,L.V)(s,r,h,[]);if(!g)return;const x=null==(e=(0,bt.Qo)(g.teamData,Z,r)[r])?void 0:e.target.data[0];if(!x)return;Object.assign(x,(0,bt.b3)([x,_i]));const b=(0,nt.Hm)(null!=(t=x.display)?t:{},u);if(!b)return;const y=b,C=Object.entries(d).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,a;const i=(0,nt.Hm)(null!=(n=x.display)?n:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(a=i.info)?void 0:a.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));c(void 0);const w=new Promise((e=>we.current=e)),S=[...C.map((e=>e.value)),b],k=[...C.map((e=>e.minimum)),-1/0],X=o&&(0,nt.Hm)(null!=(i=x.display)?i:{},o);X&&(S.push(X),k.push(-1/0));const _=(0,vt.tL)(S,x,(({path:[e]})=>"dyn"!==e)),K=X?_.pop():void 0,j={arts:f,optimizationTarget:_.pop(),exclusion:l,constraints:_.map(((e,t)=>({value:e,min:k[t]}))),topN:m,plotBase:K},P={tested:0,failed:0,skipped:0,total:0,startTime:performance.now()},E=setInterval((()=>B(Object.assign({type:"active"},P))),100),O=new Error;try{const e=new GOSolver(j,P,I);w.then((()=>e.cancel(O)));const t=await e.solve();if(e.cancel(),we.current=()=>{},X){var T,A;const e=function(e){let t=.01,n=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;n.size>1500;)t*=2,n=new Set([...n].map((e=>Math.round(e/2))));const a={};for(const i of e)for(const e of Object.values(i)){const n=Math.round(e.plot/t)*t;(!a[n]||a[n].value<e.value)&&(a[n]=e)}return a}(t.map((e=>e.plotData)));let n=Object.values(e);"%"===(null==(T=y.info)?void 0:T.unit)&&(n=n.map((({value:e,plot:t,artifactIds:n})=>({value:100*e,plot:t,artifactIds:n})))),"%"===(null==(A=X.info)?void 0:A.unit)&&(n=n.map((({value:e,plot:t,artifactIds:n})=>({value:e,plot:100*(null!=t?t:0),artifactIds:n})))),c({valueNode:y,plotNode:X,data:n})}const a=function(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}(t.map((e=>e.builds)),m);0,re({builds:a.map((e=>e.artifactIds)),buildDate:Date.now()}),setTimeout((()=>{t&&v.current&&(Mi.play(),Ce.current||setTimeout((()=>window.alert(n(Ki||(Ki=Di`buildCompleted`)))),1))}),100)}catch(D){D!==O&&(console.log("Failed to load worker"),console.log(D),D instanceof Error&&Be(D)),we.current(),P.tested=0,P.failed=0,P.skipped=0,P.total=0}finally{clearInterval(E),B(Object.assign({type:"inactive"},P,{finishTime:performance.now()}))}}),[V,r,me,s,Z,c,I,re,n,Be]),ke=null!=(t=null==se?void 0:se.name)?t:"Character Name",Xe=(0,x.useCallback)((e=>{F({plotBase:e}),c(void 0)}),[F,c]),Ke=(0,x.useMemo)((()=>oe&&le&&{data:oe,teamData:le}),[oe,le]),je=(0,z.tZ)(Aa.Z,{optimizationTarget:U,setTarget:e=>F({optimizationTarget:e}),disabled:!!k}),Pe=(0,x.useCallback)((e=>(0,z.BX)(b.cC,{t:n,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[n]),Ee=(0,x.useCallback)((e=>`#${e+1}`),[]);return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[$&&(0,z.tZ)(he.Z,{severity:"warning",variant:"filled",children:(0,z.BX)(b.cC,{t:n,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the",(0,z.tZ)(st.Z,{component:y.rU,to:"/artifacts",children:"Artifacts"}),"page and add some!"]})}),Ke&&(0,z.BX)(K.R.Provider,{value:Ke,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(ht.Z,{characterKey:r,onClickTeammate:W})}),(0,z.tZ)(En,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(w.Z,{children:[(0,z.BX)(p.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:n(ji||(ji=Di`levelFilter`))}),(0,z.tZ)(X.Z,{color:"info",children:be.in})]}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(dt.Z,{levelLow:te,levelHigh:ne,setLow:e=>F({levelLow:e}),setHigh:e=>F({levelHigh:e}),setBoth:(e,t)=>F({levelLow:e,levelHigh:t}),disabled:k})})]}),(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{sx:{fontWeight:"bold"},children:n(Pi||(Pi=Di`mainStat.title`))})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,z.tZ)(Kn,{mainStatAssumptionLevel:J,setmainStatAssumptionLevel:e=>F({mainStatAssumptionLevel:e}),disabled:k}),(0,z.tZ)(pt.Z,{title:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{variant:"h6",children:n(Ei||(Ei=Di`mainStat.levelAssTooltip.title`))}),(0,z.tZ)(Y.Z,{children:n(Oi||(Oi=Di`mainStat.levelAssTooltip.desc`))})]})})]})}),(0,z.tZ)(bi,{disabled:k,filteredArtIdMap:xe})]})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:5,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(Bn,{disabled:k}),(0,z.tZ)(hi,{disabled:k,excludedTotal:ye.in}),(0,z.tZ)(g.Z,{fullWidth:!0,startIcon:Q?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:Q?"success":"secondary",onClick:()=>F({allowPartial:!Q}),disabled:k,children:n(Ti||(Ti=Di`allowPartial`))}),(0,z.tZ)(qt,{disabled:k,allowListTotal:ve.in}),(0,z.tZ)(ki,{disabled:k})]})]}),de&&je,(0,z.BX)(_e.Z,{children:[!de&&je,(0,z.BX)(Zt.Z,{disabled:k||!r,title:(0,z.BX)(b.cC,{t:n,i18nKey:"build",count:ee,children:[{count:ee}," Builds"]}),children:[(0,z.tZ)(ot.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:n("buildDropdownDesc")})}),(0,z.tZ)(q.Z,{}),xt.sY.map((e=>(0,z.tZ)(ot.Z,{onClick:()=>F({maxBuildsToShow:e}),children:(0,z.BX)(b.cC,{t:n,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,z.BX)(Zt.Z,{disabled:k||!r,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,z.BX)(b.cC,{t:n,i18nKey:"thread",count:I,children:[{count:I}," Threads"]}),children:[(0,z.tZ)(ot.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:n("threadDropdownDesc")})}),(0,z.tZ)(q.Z,{}),(0,nt.w6)(1,gt.g).reverse().map((e=>(0,z.tZ)(ot.Z,{onClick:()=>R(e),children:(0,z.BX)(b.cC,{t:n,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,z.tZ)(ut.Z,{placement:"top",title:n(Ai||(Ai=Di`notifyTooltip`)),children:(0,z.tZ)(g.Z,{sx:{borderRadius:0},color:"warning",onClick:()=>f((e=>!e)),children:m?(0,z.tZ)(rt.Z,{}):(0,z.tZ)(lt.Z,{})})}),(0,z.tZ)(ut.Z,{placement:"top",title:U?"":n("selectTargetFirst"),children:(0,z.tZ)("span",{children:(0,z.tZ)(g.Z,{disabled:!r||!U||!ce||ce.isEmpty,color:k?"error":"success",onClick:k?()=>we.current():Se,startIcon:k?(0,z.tZ)(at.Z,{}):(0,z.tZ)(o.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:n(k?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),!!r&&(0,z.tZ)(Dn,{status:C,characterName:ke,maxBuildsToShow:ee}),(0,z.tZ)(h.Z,{children:(0,z.tZ)(Ua,{disabled:k||!U,plotBase:H,setPlotBase:Xe,showTooltip:!U})}),(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.BX)(h.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:ae?(0,z.BX)("span",{children:["Showing"," ",(0,z.tZ)("strong",{children:ae.length+(d?d.length:0)})," ","build generated for ",ke,"."," ",!!ie&&(0,z.BX)("span",{children:["Build generated on:"," ",(0,z.tZ)("strong",{children:new Date(ie).toLocaleString()})]})]}):(0,z.tZ)("span",{children:"Select a character to generate builds."})}),(0,z.tZ)(g.Z,{disabled:!ae.length,color:"error",onClick:()=>{u(void 0),re({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,z.BX)(ue.ZP,{container:!0,display:"flex",spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.oX,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.BX)(mt.Z,{exclusive:!0,value:l,onChange:(e,t)=>G({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!l,children:"Show new builds"}),(0,z.tZ)(ct.Z,{value:!0,disabled:l,children:"Compare vs. equipped"})]})})]})]})}),(0,z.BX)(ft.Provider,{value:U,children:[d&&(0,z.tZ)(Ii,{builds:d,characterKey:r,data:oe,compareData:l,disabled:!!k,getLabel:Pe,setBuilds:u}),(0,z.tZ)(Ii,{builds:ae,characterKey:r,data:oe,compareData:l,disabled:!!k,getLabel:Ee})]})]})]})}function Ii({builds:e,setBuilds:t,characterKey:n,data:a,compareData:i,disabled:r,getLabel:l}){const s=(0,x.useCallback)((n=>{if(t){const a=[...e];a.splice(n,1),t(a)}}),[e,t]);return(0,x.useMemo)((()=>(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,o)=>n&&a&&(0,z.tZ)(Gi,{characterKey:n,build:e,oldData:a,children:(0,z.tZ)(Ri,{index:o,label:l(o),build:e,compareData:i,disabled:r,deleteBuild:t?s:void 0})},o+e.join())))})),[e,n,a,i,r,l,s,t])}function Ri({index:e,label:t,build:n,compareData:a,disabled:i,deleteBuild:r}){const{t:l}=(0,b.$G)("page_character_optimize"),s=(0,v.TH)(),o=(0,v.s0)(),d=(0,x.useCallback)((()=>{const e=s.pathname.split("/");e.pop(),o(`${e.join("/")}/theorycraft`,{state:{build:n}})}),[o,n,s.pathname]);return(0,z.tZ)(xa,{label:t,compareBuild:a,disabled:i,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(g.Z,{color:"info",size:"small",startIcon:(0,z.tZ)(c.Z,{}),onClick:d,children:l("theorycraftButton")}),r&&(0,z.tZ)(g.Z,{color:"error",size:"small",startIcon:(0,z.tZ)(it.Z,{}),onClick:()=>r(e),children:l("removeBuildButton")})]})})}function Gi({children:e,characterKey:t,build:n,oldData:a}){const{database:r}=(0,x.useContext)(T.t),{buildSetting:{mainStatAssumptionLevel:l}}=Gt(t),[s,o]=(0,i.NW)();(0,x.useEffect)((()=>r.arts.followAny((e=>n.includes(e)&&o()))),[r,n,o]);const c=(0,x.useMemo)((()=>s&&n.map((e=>r.arts.get(e))).filter((e=>e))),[s,n,r]),d=(0,L.Z)(t,l,c),u=(0,x.useMemo)((()=>{const e=null==d?void 0:d[t];if(e)return{data:e.target,teamData:d,oldData:a}}),[d,a,t]);return u?(0,z.tZ)(K.R.Provider,{value:u,children:e}):null}const Ni=n.p+"Character_Albedo_Card.5892308f446f759f.png",zi=n.p+"Character_Alhaitham_Card.390618cfb70f0e4e.jpg",Wi=n.p+"Character_Aloy_Card.b6b990337b74f55f.png",$i=n.p+"Character_Amber_Card.2830ac6d2ff3846d.jpg",Vi=n.p+"Character_Arataki_Itto_Card.e1e874752d65877c.jpg",Fi=n.p+"Character_Baizhu_Card.19f716d36f154360.jpg",qi=n.p+"Character_Barbara_Card.f372476873df3b6d.jpg",Hi=n.p+"Character_Beidou_Card.916c73f4f4a3ca3c.jpg",Ui=n.p+"Character_Bennett_Card.25f8771de05532d0.jpg",Yi=n.p+"Character_Candace_Card.6353e91b7bcd4404.jpg",Ji=n.p+"Character_Chongyun_Card.1770f1995289db9c.jpg",Qi=n.p+"Character_Collei_Card.aaa7e8dc2183674d.jpg",er=n.p+"Character_Cyno_Card.65e14ca6391b2f37.jpg",tr=n.p+"Character_Dehya_Card.eeff4efcde0ab4f5.jpg",nr=n.p+"Character_Diluc_Card.18a7a83ac9ce0b87.jpg",ar=n.p+"Character_Diona_Card.21bd261dfcfe1c21.png",ir=n.p+"Character_Dori_Card.ab5ef6d6304aec80.jpg",rr=n.p+"Character_Eula_Card.e680ce8ea2567c4f.png",lr=n.p+"Character_Faruzan_Card.8e06d53607285885.jpg",sr=n.p+"Character_Fischl_Card.d45651a83cfbca82.jpg",or=n.p+"Character_Freminet_Card.9d2a6e594423439d.jpg",cr=n.p+"Character_Ganyu_Card.5dc050fe16cea049.png",dr=n.p+"Character_Gorou_Card.50bf591a764d2242.png",ur=n.p+"Character_Hu_Tao_Card.d087463aac3ba35f.png",hr=n.p+"Character_Jean_Card.36b2f258f4290f55.jpg",Zr=n.p+"Character_Kaeya_Card.b2645bca5fa7a637.jpg",pr=n.p+"Character_Kaveh_Card.7f11be5aaf366a88.jpg",mr=n.p+"Character_Kamisato_Ayaka_Card.e481f78f6bb51a31.png",fr=n.p+"Character_Kamisato_Ayato_Card.c32d0bbba107a804.png",gr=n.p+"Character_Kazuha_Card.09ababa93ec3a3e2.png",xr=n.p+"Character_Keqing_Card.ed7c0168559732f6.jpg",br=n.p+"Character_Kirara_Card.f5792590c4f5a97d.jpg",vr=n.p+"Character_Klee_Card.e0ee4daa68e99a52.jpg",yr=n.p+"Character_Kujou_Sara_Card.1f934a5832be2b5c.jpg",Cr=n.p+"Character_Kuki_Shinobu_Card.3247590264aa41ec.jpg",wr=n.p+"Character_Layla_Card.1e4a55ea008f4fa2.jpeg",Br=n.p+"Character_Lisa_Card.4966ba74ac03470a.jpg",Sr=n.p+"Character_Lyney_Card.83574b5d5adf4c43.jpg",kr=n.p+"Character_Lynette_Card.1a7ba1c24c9aa9d3.jpg",Xr=n.p+"Character_Mika_Card.280a1899f15cfea5.jpg",_r=n.p+"Character_Mona_Card.d14df945153b29c3.jpg",Kr=n.p+"Character_Nahida_Card.c01ab425bddc31ae.jpeg",jr=n.p+"Character_Neuvillette_Card.d775e9330c010b45.jpg",Pr=n.p+"Character_Nilou_Card.13f5e94ed5181b37.jpg",Er=n.p+"Character_Ningguang_Card.cd89f11944f1c9cd.jpg",Or=n.p+"Character_Noelle_Card.394f26d7473fd2ad.jpg",Tr=n.p+"Character_Qiqi_Card.8728d970279d46ac.jpg",Ar=n.p+"Character_Raiden_Shogun_Card.56a2190f00c137f3.png",Dr=n.p+"Character_Razor_Card.1b116c57394d4b1b.jpg",Mr=n.p+"Character_Rosaria_Card.8267339e414b4b96.png",Lr=n.p+"Character_Sangonomiya_Kokomi_Card.843fc41e00f54a04.jpg",Ir=n.p+"Character_Sayu_Card.5d2a94faea5e0c8e.png",Rr=n.p+"Character_Shenhe_Card.883f751b234b9ec6.jpg",Gr=n.p+"Character_Shikanoin_Heizou_Card.e3c6c8b01018558e.png",Nr=n.p+"Character_Somnia_Card.36432f04e4174367.png",zr=n.p+"Character_Sucrose_Card.a5b72ffa09e14920.jpg",Wr=n.p+"Character_Tartaglia_Card.daa075230d685675.png",$r=n.p+"Character_Thoma_Card.8aaf239f62fe5ce8.jpg",Vr=n.p+"Character_Tighnari_Card.c59a95c5d6c8e80b.jpg",Fr=n.p+"Character_Venti_Card.53c36f1f18e39e8c.jpg",qr=n.p+"Character_Wanderer_Card.9280e378fab9bec7.jpg",Hr=n.p+"Character_Xiangling_Card.5693675f27b0f2d7.jpg",Ur=n.p+"Character_Xiao_Card.505ee35780a80258.jpg",Yr=n.p+"Character_Xingqiu_Card.7eb5998349f9541d.jpg",Jr=n.p+"Character_Xinyan_Card.592529410cb0ab30.jpg",Qr=n.p+"Character_Yae_Miko_Card.4ad3e897b1e3a097.png",el=n.p+"Character_Yanfei_Card.0e3112d6ef574c1a.png",tl=n.p+"Character_Yaoyao_Card.b1085e13b40477e1.jpg",nl=n.p+"Character_Yelan_Card.3a483ca01484e384.jpg",al=n.p+"Character_Yoimiya_Card.cd7bc5df84521f72.png",il=n.p+"Character_Yun_Jin_Card.f980c03bc03f7f1d.jpg",rl=n.p+"Character_Zhongli_Card.34830d011897679b.png",ll={Albedo:Ni,Alhaitham:zi,Aloy:Wi,Amber:$i,AratakiItto:Vi,Baizhu:Fi,Barbara:qi,Beidou:Hi,Bennett:Ui,Candace:Yi,Chongyun:Ji,Collei:Qi,Cyno:er,Dehya:tr,Diluc:nr,Diona:ar,Dori:ir,Eula:rr,Faruzan:lr,Fischl:sr,Freminet:or,Ganyu:cr,Gorou:dr,HuTao:ur,Jean:hr,KaedeharaKazuha:gr,Kaeya:Zr,KamisatoAyaka:mr,KamisatoAyato:fr,Kaveh:pr,Keqing:xr,Kirara:br,Klee:vr,KujouSara:yr,KukiShinobu:Cr,Layla:wr,Lisa:Br,Lyney:Sr,Lynette:kr,Mika:Xr,Mona:_r,Nahida:Kr,Neuvillette:jr,Nilou:Pr,Ningguang:Er,Noelle:Or,Qiqi:Tr,RaidenShogun:Ar,Razor:Dr,Rosaria:Mr,SangonomiyaKokomi:Lr,Sayu:Ir,Shenhe:Rr,ShikanoinHeizou:Gr,Somnia:Nr,Sucrose:zr,Tartaglia:Wr,Thoma:$r,Tighnari:Vr,TravelerF:n.p+"Traveler_Female_Card.fa3a506cfdb64634.jpg",TravelerM:n.p+"Traveler_Male_Card.68e79e7eeb25b514.jpg",Venti:Fr,Wanderer:qr,Xiangling:Hr,Xiao:Ur,Xingqiu:Yr,Xinyan:Jr,YaeMiko:Qr,Yanfei:el,Yaoyao:tl,Yelan:nl,Yoimiya:al,YunJin:il,Zhongli:rl};var sl=n(55290),ol=n(16068),cl=n(66147),dl=n(63303),ul=n(36674),hl=n(15132),Zl=n(85469),pl=n(49810),ml=n(86432),fl=n(23883),gl=n(71179),xl=n(96580),bl=n(73501),vl=n(29687);let yl,Cl=e=>e;function wl({artId:e,weaponId:t}){const{t:n}=(0,b.$G)("page_character"),[a,r,l]=(0,i.aV)(!1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ae.Z,{open:a,onClose:l,containerProps:{maxWidth:"xl"},children:(0,z.tZ)(Bl,{artId:e,weaponId:t,onHide:l})}),(0,z.tZ)(fl.Z,{title:(0,z.tZ)(Y.Z,{children:n(yl||(yl=Cl`tabEquip.compare`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:r,children:(0,z.tZ)(vl.Z,{})})})]})}function Bl({artId:e,weaponId:t,onHide:n}){const{database:a}=(0,x.useContext)(T.t),{character:{key:i,equippedArtifacts:r}}=(0,x.useContext)(_.K),{buildSetting:{mainStatAssumptionLevel:l}}=Gt(i),{data:s}=(0,x.useContext)(K.R),o=(0,x.useMemo)((()=>{const t=a.arts.get(null!=e?e:""),n=(0,nt.Ay)(r,((e,n)=>n===(null==t?void 0:t.slotKey)?t:a.arts.get(e)));return Object.values(n).filter((e=>e))}),[a,r,e]),c=(0,L.Z)(i,l,o,t?a.weapons.get(t):void 0),d=(0,x.useMemo)((()=>c&&{data:c[i].target,teamData:c,oldData:s}),[i,c,s]);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:600}),children:d&&(0,z.tZ)(K.R.Provider,{value:d,children:(0,z.tZ)(xa,{compareBuild:!0,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(S.Hn,{size:"small"}),(0,z.tZ)(S.oX,{size:"small"})]}),extraButtonsRight:(0,z.tZ)(g.Z,{size:"small",color:"error",onClick:n,children:(0,z.tZ)(at.Z,{})})})})})}let Sl,kl=e=>e;const Xl={xs:6,sm:6,md:9,lg:12,xl:12},_l=(0,x.lazy)((()=>Promise.resolve().then(n.bind(n,22537))));function Kl({onChangeId:e,slotKey:t,show:n,onClose:a}){const{t:r}=(0,b.$G)("page_character"),{database:l}=(0,x.useContext)(T.t),s=(0,x.useCallback)((t=>{e(t),a()}),[e,a]),o=(0,x.useCallback)(((e,n)=>Object.assign({},e,n,{slotKeys:[t]})),[t]),[c,d]=(0,x.useReducer)(o,Object.assign({},(0,ri.Af)(),{slotKeys:[t]})),[u,m]=(0,i.NW)();(0,x.useEffect)((()=>l.arts.followAny(m)),[l,m]);const f=(0,i.JT)(),g=(0,x.useMemo)((()=>(0,ri.EM)()),[]),v=(0,x.useMemo)((()=>{const e=(0,nt.CZ)(c,g);return u&&l.arts.values.filter(e).map((e=>e.id)).slice(0,Xl[f])}),[u,l,g,c,f]);return(0,z.tZ)(ae.Z,{open:n,onClose:a,containerProps:{maxWidth:"xl"},children:(0,z.BX)(C.Z,{children:[(0,z.BX)(p.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:Gn.CL.slot[t]}):null," ",r(Sl||(Sl=kl`tabEquip.swapArt`))]}),(0,z.tZ)(B.Z,{onClick:a})]}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(_l,{filterOption:c,filterOptionDispatch:d,filteredIds:v,disableSlotFilter:!0})}),(0,z.tZ)(h.Z,{mt:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:v.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ua.Z,{artifactId:e,extraButtons:(0,z.tZ)(wl,{artId:e}),onClick:s})},e)))})})})]})]})})}var jl=n(92252),Pl=n(18571),El=n(64262),Ol=n(54578),Tl=n(7794);let Al,Dl=e=>e;const Ml=(0,gi.X)([...a.U1]);function Ll({onChangeId:e,weaponTypeKey:t,show:n,onClose:r}){const{t:l}=(0,b.$G)(["page_character","page_weapon","weaponNames_gen"]),{database:s}=(0,x.useContext)(T.t),[o,c]=(0,x.useState)(!1),d=(0,x.useCallback)((t=>{e(t),r()}),[e,r]),[u,Z]=(0,x.useState)(""),m=(0,x.useCallback)((e=>{Z(s.weapons.new((0,Tl.xg)(e)))}),[s,Z]),f=(0,x.useCallback)((()=>Z("")),[]),[v,y]=(0,i.NW)();(0,x.useEffect)((()=>s.weapons.followAny(y)),[y,s]);const[w,S]=(0,x.useState)([5,4,3]),[k,X]=(0,x.useState)(""),_=(0,x.useDeferredValue)(k),K=(0,x.useMemo)((()=>{var e,n;return null!=(e=v&&s.weapons.values.filter((0,nt.CZ)({weaponType:t,rarity:w,name:_},(0,Ol.Xg)())).sort((0,nt.ef)(null!=(n=Ol.gd.level)?n:[],!1,(0,Ol.Sn)())).map((e=>e.id)))?e:[]}),[v,s,w,t,_]);return(0,z.tZ)(ae.Z,{open:n,onClose:r,children:(0,z.BX)(C.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(Pl.default,{show:o,onHide:()=>c(!1),onSelect:m,weaponTypeFilter:t})}),(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(El.default,{weaponId:u,footer:!0,onClose:f})}),(0,z.tZ)(p.Z,{sx:{py:1},children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:Gn.CL.weaponTypes[t]}):null," ",l(Al||(Al=Dl`page_character:tabEquip.swapWeapon`))]})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(B.Z,{onClick:r})})]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(mt.Z,{sx:{height:"100%"},value:w,size:"small",children:a.U1.map((e=>(0,z.tZ)(ct.Z,{value:e,onClick:()=>S(Ml(w,e)),children:(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)("strong",{children:e}),(0,z.tZ)(Jt.Z,{})]})},e)))})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(At.Z,{autoFocus:!0,size:"small",value:k,onChange:e=>X(e.target.value),label:l("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,z.tZ)(g.Z,{fullWidth:!0,onClick:()=>c(!0),color:"info",startIcon:(0,z.tZ)(jl.Z,{}),children:l("page_weapon:addWeapon")}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:K.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,z.tZ)(bl.Z,{weaponId:e,onClick:d,extraButtons:(0,z.tZ)(wl,{weaponId:e})})},e)))})]})]})})}let Il,Rl,Gl,Nl,zl,Wl,$l,Vl=e=>e;const Fl=(0,x.lazy)((()=>Promise.resolve().then(n.bind(n,64262))));function ql(){var e;const{character:{equippedWeapon:t,key:n},characterSheet:i}=(0,x.useContext)(_.K),{teamData:r,data:l}=(0,x.useContext)(K.R),s=null==(e=r[n])?void 0:e.weaponSheet,[o,c]=(0,x.useState)(""),d=(0,x.useCallback)((()=>c(t)),[t]),u=(0,x.useCallback)((()=>c("")),[]);(0,x.useEffect)((()=>{o&&o!==t&&c(t)}),[o,t]);const Z=(0,$n.Z)(),p=(0,ml.Z)(Z.breakpoints.up("lg")),m=(0,x.useMemo)((()=>s&&s.document.length>0&&(0,z.tZ)(w.Z,{children:(0,z.tZ)(h.Z,{p:1,children:(0,z.tZ)(en.Z,{sections:s.document})})})),[s]),{rvFilter:f}=(0,hl.Z)(n),g=(0,x.useDeferredValue)(f),b=(0,x.useMemo)((()=>new Set(g)),[g]);return(0,z.BX)(h.Z,{children:[(0,z.tZ)(x.Suspense,{fallback:!1,children:(0,z.tZ)(Fl,{weaponId:o,footer:!0,onClose:u,extraButtons:(0,z.tZ)(Yl,{weaponTypeKey:i.weaponTypeKey})})}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[p&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[m&&m,(0,z.tZ)(Ql,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(bl.Z,{weaponId:t,onEdit:d,canEquip:!0,extraButtons:(0,z.tZ)(Ul,{weaponTypeKey:i.weaponTypeKey})})}),a.Ex.map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,children:l.get(ve.ri.art[e].id).value?(0,z.tZ)(ua.Z,{artifactId:null==(t=l.get(ve.ri.art[e].id).value)?void 0:t.toString(),effFilter:b,extraButtons:(0,z.tZ)(Jl,{slotKey:e}),editorProps:{},canEquip:!0}):(0,z.tZ)(Hl,{slotKey:e})},e)}))]}),!p&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[m&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,children:m}),(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,z.tZ)(Ql,{})})]})]})]})}function Hl({slotKey:e}){const{character:{key:t}}=(0,x.useContext)(_.K),{database:n}=(0,x.useContext)(T.t),[r,l,s]=(0,i.aV)(),{t:o}=(0,b.$G)("artifact");return(0,z.BX)(w.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{children:[(0,z.tZ)(Dt.Z,{iconProps:pe.mX,slotKey:e})," ",o(`slotName.${e}`)]})}),(0,z.tZ)(q.Z,{}),(0,z.BX)(h.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,z.tZ)(Kl,{slotKey:e,show:r,onClose:s,onChangeId:e=>n.arts.set(e,{location:(0,a.V7)(t)})}),(0,z.tZ)(g.Z,{onClick:l,color:"info",sx:{borderRadius:"1em"},children:(0,z.tZ)(Zl.Z,{sx:{height:100,width:100}})})]})]})}function Ul({weaponTypeKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:n}}=(0,x.useContext)(_.K),{database:r}=(0,x.useContext)(T.t),[l,s,o]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(fl.Z,{title:(0,z.tZ)(Y.Z,{children:t(Il||(Il=Vl`tabEquip.swapWeapon`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,z.tZ)(Zl.Z,{})})}),(0,z.tZ)(Ll,{weaponTypeKey:e,onChangeId:e=>r.weapons.set(e,{location:(0,a.V7)(n)}),show:l,onClose:o})]})}function Yl({weaponTypeKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:n}}=(0,x.useContext)(_.K),{database:r}=(0,x.useContext)(T.t),[l,s,o]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(g.Z,{color:"info",onClick:s,startIcon:(0,z.tZ)(Zl.Z,{}),children:t(Rl||(Rl=Vl`tabEquip.swapWeapon`))}),(0,z.tZ)(Ll,{weaponTypeKey:e,onChangeId:e=>r.weapons.set(e,{location:(0,a.V7)(n)}),show:l,onClose:o})]})}function Jl({slotKey:e}){const{t}=(0,b.$G)("page_character"),{character:{key:n}}=(0,x.useContext)(_.K),{database:r}=(0,x.useContext)(T.t),[l,s,o]=(0,i.aV)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(fl.Z,{title:(0,z.tZ)(Y.Z,{children:t(Gl||(Gl=Vl`tabEquip.swapArt`))}),placement:"top",arrow:!0,children:(0,z.tZ)(g.Z,{color:"info",size:"small",onClick:s,children:(0,z.tZ)(Zl.Z,{})})}),(0,z.tZ)(Kl,{slotKey:e,show:l,onClose:o,onChangeId:e=>r.arts.set(e,{location:(0,a.V7)(n)})})]})}function Ql(){const{t:e}=(0,b.$G)(["page_character","artifact"]),{database:t}=(0,x.useContext)(T.t),{character:n,character:{key:r,equippedArtifacts:l}}=(0,x.useContext)(_.K),{data:s}=(0,x.useContext)(K.R),o=(0,x.useMemo)((()=>!!Object.values(l).filter((e=>e)).length),[l]),c=(0,x.useCallback)((()=>{n&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(l).forEach((e=>t.arts.set(e,{location:""})))}),[n,t,l]),d=(0,x.useMemo)((()=>(0,Qt.ND)(s)),[s]),{rvFilter:u}=(0,hl.Z)(r),Z=(0,x.useCallback)((e=>t.charMeta.set(r,{rvFilter:e})),[t,r]),[m,f,v]=(0,i.aV)(),y=(0,x.useDeferredValue)(u),{rvField:B,rvmField:S}=(0,x.useMemo)((()=>{const{currentEfficiency:n,currentEfficiency_:i,maxEfficiency:r,maxEfficiency_:s}=Object.values(l).reduce(((e,n)=>{const i=t.arts.get(n);if(i){const{currentEfficiency:t,maxEfficiency:n}=Fn.Z.getArtifactEfficiency(i,new Set(y)),{currentEfficiency:r,maxEfficiency:l}=Fn.Z.getArtifactEfficiency(i,new Set(a._m));e.currentEfficiency=e.currentEfficiency+t,e.maxEfficiency=e.maxEfficiency+n,e.currentEfficiency_=e.currentEfficiency_+r,e.maxEfficiency_=e.maxEfficiency_+l}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0});return{rvField:{text:e(Nl||(Nl=Vl`artifact:editor.curSubEff`)),value:n-i?(0,z.BX)("span",{children:[(0,z.tZ)(xl.Z,{value:n,max:4500,valid:!0})," /"," ",(0,z.tZ)(xl.Z,{value:i,max:4500,valid:!0})]}):(0,z.tZ)(xl.Z,{value:n,max:4500,valid:!0})},rvmField:{text:e(zl||(zl=Vl`artifact:editor.maxSubEff`)),canShow:()=>!!(i-s),value:r-s?(0,z.BX)("span",{children:[(0,z.tZ)(xl.Z,{value:r,max:4500,valid:!0})," /"," ",(0,z.tZ)(xl.Z,{value:s,max:4500,valid:!0})]}):(0,z.tZ)(xl.Z,{value:r,max:4500,valid:!0})}}}),[e,y,l,t]);return(0,z.BX)(w.Z,{children:[o&&(0,z.tZ)(g.Z,{color:"error",onClick:c,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(Wl||(Wl=Vl`tabEquip.unequipArts`))}),(0,z.tZ)(h.Z,{p:1,children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(C.Z,{children:[(0,z.tZ)(g.Z,{fullWidth:!0,color:"info",startIcon:(0,z.tZ)(pl.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:f,children:"RV Filter"}),(0,z.tZ)(ae.Z,{open:m,onClose:v,children:(0,z.tZ)(C.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Y.Z,{textAlign:"center",gutterBottom:!0,variant:"h6",children:e($l||($l=Vl`artifact:efficiencyFilter.title`))}),(0,z.tZ)(gl.Z,{selectedKeys:u,onChange:Z})]})})}),(0,z.BX)(Ie.lD,{children:[(0,z.tZ)(Ie.ms,{field:B,component:Ze.ZP}),(null==S||null==S.canShow?void 0:S.canShow(s))&&(0,z.tZ)(Ie.ms,{field:S,component:Ze.ZP})]})]}),d&&Object.entries(d).flatMap((([e,t])=>t.map((t=>(0,z.tZ)(tn,{setKey:e,setNumKey:t},e+t)))))]})})]})}function es(){const e=(0,x.useRef)(),t=(0,x.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,z.tZ)(ns,{})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(ts,{onClick:t}),(0,z.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:(0,z.tZ)(aa,{})})]})]}),(0,z.tZ)(h.Z,{ref:e,children:(0,z.tZ)(ql,{})})]})}function ts({onClick:e}){const{character:{equippedWeapon:t}}=(0,x.useContext)(_.K),{data:n}=(0,x.useContext)(K.R);return(0,z.BX)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ca,{weaponId:t,BGComponent:w.Z,onClick:e})}),a.Ex.map((t=>{var a;return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ea,{artifactId:null==(a=n.get(ve.ri.art[t].id).value)?void 0:a.toString(),slotKey:t,BGComponent:w.Z,onClick:e})},t)}))]})}function ns(){const{silly:e}=(0,x.useContext)(E.E),{characterSheet:t,character:{key:n,team:a}}=(0,x.useContext)(_.K),{gender:i}=(0,M.Z)(),{data:r}=(0,x.useContext)(K.R),l=(0,D.Z)(n),s=(0,v.s0)(),o=r.get(ve.ri.lvl).value,c=r.get(ve.ri.asc).value,d=r.get(ve.ri.constellation).value,u={auto:r.get(ve.ri.total.auto).value,skill:r.get(ve.ri.total.skill).value,burst:r.get(ve.ri.total.burst).value},Z={auto:r.get(ve.ri.total.autoBoost).value,skill:r.get(ve.ri.total.skillBoost).value,burst:r.get(ve.ri.total.burstBoost).value},p=(0,sl.V)(n,i),m=function(e,t){var n,a;switch(e){case"TravelerAnemo":case"TravelerDendro":case"TravelerElectro":case"TravelerGeo":case"TravelerHydro":return null!=(n=ll[`Traveler${t}`])?n:"";default:return null!=(a=ll[e])?a:""}}(n,i);return(0,z.BX)(w.Z,{sx:{height:"100%"},children:[e&&p?(0,z.tZ)(as,{src:p,level:o,ascension:c}):(0,z.tZ)(is,{src:m,level:o,ascension:c}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(Wn.Z,{sx:{p:1},onClick:()=>s("talent"),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((e=>{var n;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(dl.Z,{badgeContent:u[e],color:Z[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,z.tZ)(h.Z,{component:"img",src:null==(n=t.getTalentOfKey(e))?void 0:n.img,width:"100%",height:"auto"})})},e)}))})}),(0,z.tZ)(Y.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:t.constellationName}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:(0,vi.w6)(1,6).map((e=>{var n;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(Wn.Z,{onClick:()=>l({constellation:e===d?e-1:e}),children:(0,z.tZ)(h.Z,{component:"img",src:null==(n=t.getTalentOfKey(`constellation${e}`))?void 0:n.img,sx:Object.assign({},d>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,z.tZ)(Wn.Z,{sx:{p:1},onClick:()=>s("teambuffs"),children:(0,z.tZ)(ue.ZP,{container:!0,columns:3,spacing:1,children:(0,vi.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,height:"100%",children:a[e]?(0,z.tZ)(Mt.Z,{characterKey:a[e]}):(0,z.tZ)(Mt.D,{index:e})},e)))})})]})]})}function as({src:e,level:t,ascension:n}){const{characterSheet:a}=(0,x.useContext)(_.K);return(0,z.BX)(h.Z,{sx:{position:"relative"},children:[(0,z.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"}),(0,z.BX)(h.Z,{sx:{width:"100%",height:"100%"},children:[(0,z.tZ)(h.Z,{sx:{opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(rs,{})}),(0,z.tZ)(Y.Z,{variant:"h6",sx:{width:"100%",opacity:.75,textAlign:"center"},children:(0,z.tZ)(ul.q,{stars:a.rarity,colored:!0})}),(0,z.tZ)(ss,{}),(0,z.tZ)(ls,{level:t,ascension:n})]})]})}function is({src:e,level:t,ascension:n}){const{characterSheet:a}=(0,x.useContext)(_.K);return(0,z.BX)(h.Z,{sx:{position:"relative"},children:[(0,z.BX)(h.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,z.tZ)(Y.Z,{variant:"h6",sx:{position:"absolute",width:"100%",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75,textAlign:"center"},children:(0,z.tZ)(ul.q,{stars:a.rarity,colored:!0})}),(0,z.tZ)(h.Z,{sx:{position:"absolute",left:"50%",bottom:"7%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(rs,{})}),(0,z.tZ)(ss,{}),(0,z.tZ)(ls,{level:t,ascension:n})]}),(0,z.tZ)(h.Z,{src:e,component:"img",width:"100%",height:"auto"})]})}function rs(){var e;const{characterSheet:t}=(0,x.useContext)(_.K),n=t.elementKey;return(0,z.tZ)(xe.Z,{color:n,sx:{height:"auto"},label:(0,z.BX)(Y.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(Ce.Z,{ele:n}),(0,z.tZ)(h.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:t.name}),(0,z.tZ)(ne.Z,{src:null==(e=Gn.CL.weaponTypes)?void 0:e[t.weaponTypeKey]})]})})}function ls({level:e,ascension:t}){return(0,z.tZ)(Y.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,z.tZ)(X.Z,{children:(0,Nn.wQ)(e,t)})})}function ss(){const{character:{key:e}}=(0,x.useContext)(_.K),{database:t}=(0,x.useContext)(T.t),{favorite:n}=(0,hl.Z)(e);return(0,z.tZ)(h.Z,{sx:{position:"absolute",left:0,top:0},children:(0,z.tZ)(Se.Z,{sx:{p:1},color:"error",onClick:()=>t.charMeta.set(e,{favorite:!n}),children:n?(0,z.tZ)(ol.Z,{}):(0,z.tZ)(cl.Z,{})})})}const os={xs:12,sm:6,md:4};function cs(){const{character:e,characterSheet:t}=(0,x.useContext)(_.K),{data:n}=(0,x.useContext)(K.R),a=(0,D.Z)(e.key),i=n.get(ve.ri.asc).value,r=n.get(ve.ri.constellation).value,l=(0,$n.Z)(),s=(0,ml.Z)(l.breakpoints.up("lg")),o=(0,x.useMemo)((()=>(0,vi.w6)(1,6).map((e=>(0,z.tZ)(hs,{talentKey:`constellation${e}`,subtitle:`Constellation Lv. ${e}`,onClickTitle:()=>a({constellation:e===r?e-1:e})})))),[r,a]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ds,{}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",r]})})}),o.map(((e,t)=>(0,z.tZ)(h.Z,{sx:{opacity:r>=t+1?1:.5},children:e},t)))]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[[["auto","Normal/Charged Attack"],["skill","Elemental Skill"],["burst","Elemental Burst"]].map((([e,t])=>(0,z.tZ)(ue.ZP,Object.assign({item:!0},os,{children:(0,z.tZ)(hs,{talentKey:e,subtitle:t})}),e))),!!t.getTalentOfKey("sprint")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},os,{children:(0,z.tZ)(hs,{talentKey:"sprint",subtitle:"Alternative Sprint"})})),!!t.getTalentOfKey("passive")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},os,{children:(0,z.tZ)(hs,{talentKey:"passive",subtitle:"Passive"})})),[["passive1","Unlocked at Ascension 1",1],["passive2","Unlocked at Ascension 4",4],["passive3","Unlocked by Default",0]].map((([e,n,a])=>{const r=i>=a;return t.getTalentOfKey(e)?(0,z.tZ)(ue.ZP,Object.assign({item:!0,style:{opacity:r?1:.5}},os,{children:(0,z.tZ)(hs,{talentKey:e,subtitle:n})}),e):null}))]}),!s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",r]})})})}),o.map(((e,t)=>(0,z.tZ)(ue.ZP,Object.assign({item:!0,sx:{opacity:r>=t+1?1:.5}},os,{children:e}),t)))]})]})]})}function ds(){const{data:e}=(0,x.useContext)(K.R),t=e.getDisplay().reaction;return(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.Z,{children:(0,z.tZ)(p.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,z.tZ)(Ie.JW,{node:t})})})},e)))})})})}const us=[1,1,2,4,6,8,10];function hs({talentKey:e,subtitle:t,onClickTitle:n}){const{character:{talent:a},characterSheet:i,characterDispatch:r}=(0,x.useContext)(_.K),{data:l}=(0,x.useContext)(K.R),s=(0,x.useCallback)((e=>(0,z.tZ)(Wn.Z,{onClick:n,children:e})),[n]),o=(0,x.useCallback)(((e,t)=>r({talent:Object.assign({},a,{[e]:t})})),[a,r]);let c=null;if(e in a){const t=l.get(ve.ri.total[`${e}Boost`]).value,n=l.get(ve.ri.total[e]).value,i=l.get(ve.ri.asc).value;c=(0,z.tZ)(Zt.Z,{fullWidth:!0,title:`Talent Lv. ${n}`,color:t?"info":"primary",sx:{borderRadius:0},children:(0,vi.w6)(1,us[i]).map((n=>(0,z.BX)(ot.Z,{selected:a[e]===n,disabled:a[e]===n,onClick:()=>o(e,n),children:["Talent Lv. ",n+t]},n)))})}const d=i.getTalentOfKey(e);return(0,z.BX)(w.Z,{sx:{height:"100%"},children:[c,(0,z.BX)(p.Z,{children:[(0,z.tZ)(Un.Z,{condition:!!n,wrapper:s,children:(0,z.BX)(ue.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(h.Z,{component:"img",src:null==d?void 0:d.img,sx:{width:60,height:"auto"}})}),(0,z.BX)(ue.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null==d?void 0:d.name}),(0,z.tZ)(Y.Z,{variant:"subtitle1",children:t})]})]})}),null!=d&&d.sections?(0,z.tZ)(en.Z,{sections:d.sections,hideDesc:!0,hideHeader:t=>{var n;const a=null==(n=t.header)?void 0:n.action;if(a&&"string"!=typeof a){return a.props.children.props.key18.includes(e)}return!1}}):null]})]})}var Zs=n(88819),ps=n(4371),ms=n(87923);let fs,gs=e=>e;function xs(){return(0,z.tZ)(h.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(bs,{}),(0,z.tZ)(vs,{})]}),(0,vi.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,z.tZ)(ys,{index:e})},e)))]})})}function bs(){var e,t,n;const{data:a,oldData:i}=(0,x.useContext)(K.R),r=a.getTeamBuff(),l=[];return Object.entries(null!=(e=r.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["total",e],t]))),Object.entries(null!=(t=r.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["premod",e],t]))),Object.entries(null!=(n=r.enemy)?n:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&l.push([["enemy",e],t]))),l.length?(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{children:(0,z.tZ)(Y.Z,{children:"Team Buffs"})}),(0,z.tZ)(q.Z,{}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,children:l.map((([e,t])=>{var n;return t&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(Ie.JW,{node:t,oldValue:null==(n=(0,vi.Hm)(null==i?void 0:i.getTeamBuff(),e))?void 0:n.value})},JSON.stringify(t.info))}))})})]}):null}function vs(){const{t:e}=(0,b.$G)("page_character"),{data:t}=(0,x.useContext)(K.R),{character:{team:n}}=(0,x.useContext)(_.K),a=n.reduce(((e,t)=>e+(t?1:0)),1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(F.Z,{title:(0,z.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:a>=4?"success":"warning",children:["(",a,"/4)"]})})," ",(0,z.tZ)(pt.L,{title:(0,z.tZ)(Y.Z,{children:e(fs||(fs=gs`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),ms.J.map(((e,n)=>(0,z.BX)(w.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,z.tZ)(F.Z,{title:(0,z.BX)("span",{children:[e.name," ",(0,z.tZ)(pt.L,{title:(0,z.tZ)(Y.Z,{children:e.desc})})]}),action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,z.tZ)(q.Z,{}),e.canShow(t)&&(0,z.tZ)(p.Z,{children:(0,z.tZ)(en.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},n)))]})}function ys({index:e}){const{teamData:t}=(0,x.useContext)(K.R),{t:n}=(0,b.$G)("page_character"),{character:a,character:{key:i},characterDispatch:r}=(0,x.useContext)(_.K),l=a.team[e],s=(0,x.useMemo)((()=>[i,...a.team].filter(((t,n)=>n-1!==e))),[a.team,i,e]),o=(0,N.Z)(),c=(0,x.useCallback)((t=>r({type:"team",index:e,charKey:t})),[e,r]),d=t[l],u=(0,x.useMemo)((()=>{var e;return d&&{character:Object.assign({},d.character,{conditional:null!=(e=a.teamConditional[l])?e:{}}),characterSheet:d.characterSheet,characterDispatch:e=>{if(!l)return;if(!("conditional"in e))return;const{conditional:t}=e;t&&r({type:"teamConditional",teamMateKey:l,conditional:t})}}}),[a,l,d,r]),h=(0,x.useMemo)((()=>d&&{data:d.target,teamData:t}),[d,t]);return(0,z.BX)(w.Z,{sx:{overflow:"visible"},children:[(0,z.tZ)(Ss,{characterKey:l,team:s,setChar:c,label:n("teammate",{count:e+1})}),l&&u&&(0,z.tZ)(_.K.Provider,{value:u,children:h&&(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(ht.Z,{characterKey:l,onClickHeader:o,artifactChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(Cs,{})})}),weaponChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(ws,{})})}),characterChildren:(0,z.tZ)(_.K.Provider,{value:u,children:(0,z.tZ)(K.R.Provider,{value:h,children:(0,z.tZ)(Bs,{})})}),isTeammateCard:!0})})})]})}function Cs(){const{data:e}=(0,x.useContext)(K.R),t=(0,x.useMemo)((()=>Object.entries((0,Qt.ND)(e)).flatMap((([e,t])=>t.flatMap((t=>{var n;return null!=(n=(0,Qt.Sk)(e).setEffectDocument(t))?n:[]}))))),[e]);return t?(0,z.tZ)(en.Z,{sections:t,teamBuffOnly:!0}):null}function ws(){const{character:{key:e}}=(0,x.useContext)(_.K),{teamData:t}=(0,x.useContext)(K.R),n=t[e].weaponSheet;return n.document?(0,z.tZ)(en.Z,{sections:n.document,teamBuffOnly:!0}):null}function Bs(){const{character:{key:e}}=(0,x.useContext)(_.K),{teamData:t}=(0,x.useContext)(K.R),n=t[e].characterSheet,a=Object.values(n.talent).flatMap((e=>e.sections));return a?(0,z.tZ)(en.Z,{sections:a,teamBuffOnly:!0}):null}function Ss({characterKey:e,team:t,label:n,setChar:i,autoCompleteProps:r={}}){const{t:l}=(0,b.$G)(["sillyWisher_charNames","page_character","sheet_gen","charNames_gen"]),{database:s}=(0,x.useContext)(T.t),{gender:o}=(0,M.Z)(),{silly:c}=(0,x.useContext)(E.E),d=(0,x.useCallback)(((e,t)=>{var n;return e.startsWith("Traveler")?`${l(`${t?"sillyWisher_charNames":"charNames_gen"}:${(0,a.Cs)(e,o)}`)} (${l(`sheet_gen:element.${null==(n=(0,O.m)(e,o))?void 0:n.elementKey}`)})`:l(`${t?"sillyWisher_charNames":"charNames_gen"}:${e}`)}),[l,o]),u=(0,x.useCallback)((e=>e?(0,z.tZ)(G.Z,{characterKey:e}):(0,z.tZ)(Zs.Z,{})),[]),h=(0,x.useCallback)((e=>s.charMeta.get(e).favorite),[s]),p=(0,x.useCallback)((({key:n})=>t.filter((t=>t&&t!==e)).includes(n)||n.startsWith("Traveler")&&t.some((e=>e.startsWith("Traveler")))),[t,e]),m=(0,x.useMemo)((()=>s.chars.keys.map((e=>({key:e,label:d(e,c),favorite:h(e),alternateNames:[d(e,!1)]}))).sort(((e,t)=>e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)))),[s.chars.keys,d,h,c]);return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"text",width:100}),children:(0,z.tZ)(ps._,Object.assign({size:"small",label:n,options:m,valueKey:e,onChange:e=>i(null!=e?e:""),getOptionDisabled:p,toImg:u},r))})}var ks=n(71076),Xs=n(97183),_s=n(31114),Ks=n(47712),js=n(23128),Ps=n(40584);let Es,Os=e=>e;function Ts(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const As=x.lazy((()=>Promise.resolve().then(n.bind(n,18571))));function Ds(){var e,t;const{database:n}=(0,x.useContext)(T.t),{data:a}=(0,x.useContext)(K.R),{character:i,character:{key:r,compareData:l},characterSheet:s,characterDispatch:o}=(0,x.useContext)(_.K),c=function(e,t){const{database:n}=(0,x.useContext)(T.t),[a,i]=(0,x.useState)((()=>n.charTCs.getWithInit(e,t)));return(0,x.useEffect)((()=>i(n.charTCs.getWithInit(e,t))),[n,e,t]),(0,x.useEffect)((()=>e?n.charTCs.follow(e,((e,t,n)=>"update"===t&&i(n))):void 0),[e,i,n]),a}(r,(0,Tl.mT)(s.weaponTypeKey)),d=(0,x.useCallback)((e=>n.charTCs.set(r,e)),[r,n]),u=(0,x.useCallback)((()=>{d((0,Ps.O)((0,Tl.mT)(s.weaponTypeKey)))}),[d,s]),p=(0,x.useCallback)((e=>{d(Object.assign({},c,{weapon:Object.assign({},c.weapon,e)}))}),[d,c]),m=(0,x.useCallback)(((e,t)=>{const n=(0,Ps.O)(e.key);n.artifact.substats.type=c.artifact.substats.type,n.weapon.level=e.level,n.weapon.ascension=e.ascension,n.weapon.refinement=e.refinement;const a={};t.forEach((e=>{var t;if(!e)return;const{slotKey:i,setKey:r,substats:l,mainStatKey:s,level:o,rarity:c}=e;n.artifact.slots[i].level=o,n.artifact.slots[i].statKey=s,n.artifact.slots[i].rarity=c,a[r]=(null!=(t=a[r])?t:0)+1,l.forEach((e=>{var t;e.key&&(n.artifact.substats.stats[e.key]=(null!=(t=n.artifact.substats.stats[e.key])?t:0)+e.accurateValue)}))})),n.artifact.sets=Object.fromEntries(Object.entries(a).map((([e,t])=>[e,3===t?2:5===t?4:1!==t||e.startsWith("PrayersFor")?t:0])).filter((([,e])=>e))),d(n)}),[c,d]),f=(0,v.TH)(),{build:b}=null!=(e=f.state)?e:{build:void 0};(0,x.useEffect)((()=>{if(!b)return;const e=n.weapons.get(i.equippedWeapon);m(e,b.map((e=>n.arts.get(e))))}),[b,n]);const y=(0,x.useCallback)((()=>{const e=n.weapons.get(i.equippedWeapon);m(e,Object.values(i.equippedArtifacts).map((e=>n.arts.get(e))).filter((e=>e)))}),[n,i.equippedArtifacts,i.equippedWeapon,m]),C=(0,x.useMemo)((()=>Object.assign({},c.weapon,{location:"",lock:!1,id:""})),[c]),B=(0,x.useCallback)((e=>{const t=(0,nt.I8)(c);t.artifact=e,d(t)}),[c,d]),S=(0,x.useCallback)((e=>{const t=(0,nt.I8)(c);t.artifact.substats.type=e,d(t)}),[c,d]),k=(0,x.useCallback)((e=>{const t=(0,nt.I8)(c);t.artifact.substats.stats=e,d(t)}),[c,d]),X=(0,x.useDeferredValue)(c),j=(0,x.useMemo)((()=>{const e=Object.assign({},X.artifact.substats.stats);return Object.values(X.artifact.slots).forEach((({statKey:t,rarity:n,level:a})=>{var i;return e[t]=(null!=(i=e[t])?i:0)+(0,Nn.Bv)(t,n,a)})),{art:(0,nt.Ay)(e,((e,t)=>t.endsWith("_")?(0,Ct.aQ)(e/100):(0,Ct.a9)(e))),artSet:(0,nt.Ay)(X.artifact.sets,(e=>(0,Ct.a9)(e)))}}),[X]),P=(0,x.useMemo)((()=>({id:"",location:"",key:c.weapon.key,level:c.weapon.level,ascension:c.weapon.ascension,refinement:c.weapon.refinement,lock:!1})),[c]),E=(0,L.Z)(r,0,j,P),{target:O}=null!=(t=null==E?void 0:E[r])?t:{},A=(0,x.useMemo)((()=>{if(E&&O)return{data:O,teamData:E}}),[O,E]),D=(0,x.useMemo)((()=>{if(A)return Object.assign({},A,{oldData:l?a:void 0})}),[A,l,a]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(w.Z,{children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,z.BX)(h.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,z.tZ)(g.Z,{color:"info",onClick:y,startIcon:(0,z.tZ)(ks.Z,{}),children:"Copy from equipped"}),(0,z.tZ)(g.Z,{color:"error",onClick:u,startIcon:(0,z.tZ)(Xs.Z,{}),children:"Reset"})]}),(0,z.BX)(mt.Z,{exclusive:!0,value:l,onChange:(e,t)=>o({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!l,children:"Show TC stats"}),(0,z.tZ)(ct.Z,{value:!0,disabled:l,children:"Compare vs. equipped"})]})]})}),A?(0,z.tZ)(K.R.Provider,{value:A,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.BX)(ue.ZP,{item:!0,sx:{flexGrow:-1},children:[(0,z.tZ)(Ms,{weapon:C,setWeapon:p,weaponTypeKey:s.weaponTypeKey}),(0,z.tZ)(Ls,{artifactData:c.artifact,setArtifactData:B})]}),(0,z.tZ)(ue.ZP,{item:!0,sx:{flexGrow:1},children:(0,z.tZ)(Ns,{substats:c.artifact.substats.stats,setSubstats:k,substatsType:c.artifact.substats.type,setSubstatsType:S,mainStatKeys:Object.values(c.artifact.slots).map((e=>e.statKey))})})]})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),(0,z.tZ)(w.Z,{sx:{flexGrow:1,p:1},children:D?(0,z.tZ)(K.R.Provider,{value:D,children:(0,z.tZ)(aa,{})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500})})]})}function Ms({weapon:e,setWeapon:t,weaponTypeKey:n}){const{key:a,level:r=0,refinement:l=1,ascension:s=0}=e,o=(0,ra.ub)(a),[c,d,u]=(0,i.aV)(),{data:Z}=(0,x.useContext)(K.R),p=(0,x.useMemo)((()=>e&&(0,bt.mP)([o.data,(0,bt.v0)(e)])),[o,e]);return(0,z.BX)(w.Z,{sx:{p:1,mb:1},children:[(0,z.tZ)(As,{ascension:s,show:c,onHide:u,onSelect:e=>t({key:e}),weaponTypeFilter:n}),(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,children:[(0,z.tZ)(h.Z,{className:`grad-${o.rarity}star`,component:"img",src:(0,Gn.Aq)(e.key,s>=2),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,z.BX)(de.Z,{spacing:1,flexGrow:1,children:[(0,z.tZ)(g.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:d,children:(0,z.tZ)(h.Z,{sx:{maxWidth:"10em"},children:null==o?void 0:o.name})}),o.hasRefinement&&(0,z.tZ)(js.Z,{refinement:l,setRefinement:e=>t({refinement:e})})]})]}),(0,z.tZ)(k.Z,{level:r,ascension:s,setBoth:t,useLow:!o.hasRefinement}),(0,z.BX)(C.Z,{children:[(0,z.tZ)(F.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,z.tZ)(q.Z,{}),p&&(0,z.tZ)(Ie.lD,{children:[ve.ri.weapon.main,ve.ri.weapon.sub,ve.ri.weapon.sub2].map((e=>{const t=p.get(e);return t.isEmpty||!t.value?null:(0,z.tZ)(Ie.JW,{node:t,component:Ze.ZP},JSON.stringify(t.info))}))})]}),Z&&(null==o?void 0:o.document)&&(0,z.tZ)(en.Z,{sections:o.document})]})]})}function Ls({artifactData:e,setArtifactData:t}){const n=(0,x.useCallback)((n=>a=>{const i=(0,nt.I8)(e);i.slots[n]=a,t(i)}),[e,t]),i=(0,x.useCallback)((n=>{const a=(0,nt.I8)(e);a.sets=n,t(a)}),[e,t]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(w.Z,{sx:{p:1},children:(0,z.tZ)(de.Z,{spacing:1,children:a.Ex.map((t=>(0,z.tZ)(Is,{slotKey:t,slot:e.slots[t],setSlot:n(t)},t)))})}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(Rs,{artSet:e.sets,setArtSet:i})})]})}function Is({slotKey:e,slot:t,setSlot:n}){var i;const{level:r,statKey:l,rarity:s}=t,o=a.x1[e].stats,c=(0,x.useCallback)((e=>{n(Object.assign({},t,e))}),[t,n]),d=(0,x.useCallback)((e=>{var t;const n=null!=(t=a.F7[e])?t:0;c(r>n?{rarity:e,level:n}:{rarity:e})}),[r,c]);return(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Dt.Z,{slotKey:e}),(0,z.tZ)(C.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===o.length?(0,z.BX)(h.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[(0,z.tZ)(Ce.C,{statKey:o[0],iconProps:pe.mX})," ",ye.ZP.getStr(o[0])]}):(0,z.tZ)(Zt.Z,{sx:{px:0},fullWidth:!0,title:(0,z.tZ)(Yn,{statKey:l}),color:null!=(i=ye.ZP.getVariant(l))?i:"success",children:o.map((e=>(0,z.tZ)(ot.Z,{disabled:l===e,onClick:()=>c({statKey:e}),children:(0,z.tZ)(Jn,{statKey:e})},e)))})}),(0,z.tZ)(Zt.Z,{sx:{px:0},title:(0,z.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[s," ",(0,z.tZ)(Jt.Z,{fontSize:"inherit"})]}),children:[5,4,3].map((e=>(0,z.tZ)(ot.Z,{disabled:s===e,onClick:()=>d(e),children:(0,z.BX)(h.Z,{sx:{display:"flex",alignItems:"center"},children:[e," ",(0,z.tZ)(Jt.Z,{fontSize:"inherit"})]})},e)))}),(0,z.tZ)(Ke.ZP,{startAdornment:"+",value:r,color:Fn.Z.levelVariant(r),onChange:e=>void 0!==e&&c({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0}}),(0,z.tZ)(C.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,z.tZ)(h.Z,{p:1,textAlign:"center",children:`${(0,Nn.Jj)((0,Nn.Bv)(l,s,r),ye.ZP.unit(l))}${ye.ZP.unit(l)}`})})]})}function Rs({artSet:e,setArtSet:t}){const n=(0,x.useCallback)((n=>{n&&t(Object.assign({},e,{[n]:parseInt(Object.keys((0,Qt.Sk)(n).setEffects)[0])}))}),[e,t]),a=(0,x.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),i=(0,x.useCallback)((n=>()=>{const a=(0,we.Z)(e,[n].map(Ts));t(Object.assign({},a))}),[e,t]),r=5-Object.values(e).reduce(((e,t)=>e+t),0);return(0,z.BX)(de.Z,{spacing:1,sx:{flexGrow:1},children:[Object.entries(e).map((([e,t])=>(0,z.tZ)(Gs,{setKey:e,value:t,setValue:a(e),deleteValue:i(e),remaining:r},e))),(0,z.tZ)(w.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,z.tZ)(Ks.Z,{artSetKey:"",setArtSetKey:n,label:"New Artifact Set",getOptionDisabled:({key:t})=>Object.keys(e).includes(t)||!t||Object.keys((0,Qt.Sk)(t).setEffects).every((e=>parseInt(e)>r))})})]})}function Gs({setKey:e,value:t,setValue:n,deleteValue:a,remaining:i}){const r=(0,Qt.Sk)(e),l=(0,x.useMemo)((()=>t<4?[]:Object.keys(r.setEffects).filter((e=>{var t;return null==(t=r.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[r,t]);return(0,z.BX)(w.Z,{children:[(0,z.BX)(h.Z,{display:"flex",children:[(0,z.tZ)(ha.Z,{artifactSheet:r,numInSet:t,children:(0,z.BX)(h.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(ne.Z,{size:2,src:(0,an.jU)(e)}),(0,z.tZ)(h.Z,{children:r.setName}),(0,z.tZ)(_s.Z,{})]})}),(0,z.BX)(_e.Z,{children:[(0,z.tZ)(Zt.Z,{size:"small",title:(0,z.BX)(h.Z,{whiteSpace:"nowrap",children:[t,"-set"]}),children:Object.keys(r.setEffects).map((e=>parseInt(e))).map((e=>(0,z.BX)(ot.Z,{disabled:t===e||e>i+t,onClick:()=>n(e),children:[e,"-set"]},e)))}),(0,z.tZ)(g.Z,{color:"error",size:"small",onClick:a,children:(0,z.tZ)(it.Z,{})})]})]}),!!l.length&&(0,z.tZ)(de.Z,{spacing:1,sx:{p:1},children:l.map((t=>(0,z.tZ)(tn,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})]})}function Ns({substats:e,setSubstats:t,substatsType:n,setSubstatsType:i,mainStatKeys:r}){const l=(0,x.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),{t:s}=(0,b.$G)("page_character"),o=100*Object.entries(e).reduce(((e,[t,n])=>e+n/(0,Nn.U9)(t)),0),c=Object.entries(e).reduce(((e,[t,a])=>e+a/(0,Nn.U9)(t,void 0,n)),0);return(0,z.BX)(w.Z,{sx:{p:1,height:"100%"},children:[(0,z.BX)(h.Z,{sx:{mb:1,display:"flex",gap:1},children:[(0,z.tZ)(Zt.Z,{fullWidth:!0,title:s(`tabTheorycraft.substatType.${n}`),children:a.Ar.map((e=>(0,z.tZ)(ot.Z,{disabled:n===e,onClick:()=>i(e),children:s(`tabTheorycraft.substatType.${e}`)},e)))}),(0,z.tZ)(ut.Z,{title:(0,z.tZ)(Y.Z,{children:s(Es||(Es=Os`tabTheorycraft.maxTotalRolls`))}),placement:"top",children:(0,z.BX)(C.Z,{sx:{textAlign:"center",py:.5,px:1,minWidth:"15em",whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center"},children:[(0,z.BX)(te.Z,{color:c>45?"warning":void 0,children:["Rolls: ",(0,z.tZ)("strong",{children:c.toFixed(0)})]}),(0,z.BX)(te.Z,{color:c>45?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[o.toFixed(1),"%"]})]})]})})]}),(0,z.tZ)(de.Z,{spacing:1,children:Object.entries(e).map((([e,t])=>(0,z.tZ)(zs,{statKey:e,value:t,setValue:l(e),substatsType:n,mainStatKeys:r},e)))})]})}function zs({statKey:e,value:t,setValue:n,substatsType:a,mainStatKeys:i}){const{t:r}=(0,b.$G)("page_character"),l=(0,Nn.U9)(e,5,a),[s,o]=(0,x.useState)((()=>t/l));(0,x.useEffect)((()=>o(t/l)),[t,l]);const c=ye.ZP.unit(e),d=s*l,u=s*l/(0,Nn.U9)(e)*100,Z=i.reduce(((t,n)=>t+(n===e?1:0)),0),p=6*(5-Z),m=s-1e-4>p,f=(0,x.useCallback)((e=>n(e*l)),[n,l]);return(0,z.BX)(de.Z,{spacing:.5,children:[(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.BX)(C.Z,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(Ce.C,{statKey:e,iconProps:{fontSize:"inherit"}}),ye.ZP.getStr(e),ye.ZP.unit(e)]}),(0,z.tZ)(ut.Z,{title:(0,z.tZ)(Y.Z,{children:r(Z?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:p})}),placement:"top",children:(0,z.tZ)(C.Z,{sx:{textAlign:"center",p:.5,minWidth:"8em"},children:(0,z.BX)(te.Z,{color:m?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[u.toFixed(1),"%"]})]})})})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Ke.ZP,{color:d?"success":"primary",float:"%"===ye.ZP.unit(e),endAdornment:ye.ZP.unit(e)||(0,z.tZ)(h.Z,{width:"1em",component:"span"}),value:parseFloat(d.toFixed(2)),onChange:e=>void 0!==e&&n(e),sx:{borderRadius:1,px:1,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right"},min:0}}),(0,z.tZ)(C.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,z.tZ)(wa.ZP,{size:"small",value:s,max:p,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>o(t),onChangeCommitted:(e,t)=>f(t)})}),(0,z.tZ)(Ke.ZP,{color:t?m?"warning":"success":"primary",float:!0,startAdornment:(0,z.BX)(h.Z,{sx:{whiteSpace:"nowrap",width:"7em",display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,Nn.Jj)(l,c),c]}),(0,z.tZ)("span",{children:"x"})]}),value:parseFloat(s.toFixed(2)),onChange:e=>void 0!==e&&n(e*l),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1}})]})]})}var Ws=n(51638);function $s(){const{character:e}=(0,x.useContext)(_.K),{key:t}=e,n=(0,N.Z)();if(!t.startsWith("Traveler"))return null;const i=a.UB.find((e=>t.toLowerCase().includes(e)));return i?(0,z.tZ)(Zt.Z,{color:i,title:(0,z.tZ)("strong",{children:(0,Ws.el)(`element.${i}`)}),children:a.DZ.map((e=>(0,z.tZ)(ot.Z,{selected:i===e,disabled:i===e,onClick:()=>n((0,a.vd)(e)),children:(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:e,children:(0,Ws.el)(`element.${e}`)})})},e)))}):null}var Vs=n(2247),Fs=n(96608);function qs(){const{t:e}=(0,b.$G)("ui"),{database:t}=(0,x.useContext)(T.t),{character:n}=(0,x.useContext)(_.K),{key:a}=n,{gender:i}=(0,M.Z)(),r=(0,x.useCallback)((()=>t.dbMeta.set({gender:"F"===i?"M":"F"})),[i,t]);return a.startsWith("Traveler")?(0,z.BX)(g.Z,{onClick:r,startIcon:"F"===i?(0,z.tZ)(Vs.Z,{}):(0,z.tZ)(Fs.Z,{}),children:[(0,z.tZ)("strong",{children:e(`gender.${i}`)})," "]}):null}var Hs=n(1856),Us=n(5896);const Ys=["hp","hp_","atk","atk_","def","def_","eleMas","enerRech_","critRate_","critDMG_"],Js=[[1],[1,1,1,1],[1,2,3,4,3,2,1],[1,3,6,10,12,12,10,6,3,1],[1,4,10,20,31,40,44,40,31,20,10,4,1],[1,5,15,35,65,101,135,155,155,135,101,65,35,15,5,1]];function Qs(e,t){for(var n;e>=Js.length;){const e=Js.length,t=[];for(let n=0,s=e-1;n<=3*e;n++){var a,i,r,l;const e=null!=(a=Js[s][n-3])?a:0,o=null!=(i=Js[s][n-2])?i:0,c=null!=(r=Js[s][n-1])?r:0,d=null!=(l=Js[s][n])?l:0;t[n]=e+o+c+d}Js.push(t)}return null!=(n=Js[e][t])?n:0}function eo(e){let t=1;e<0&&(t=-1);const n=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*n-1.453152027)*n+1.421413741)*n-.284496736)*n+.254829592)*n*Math.exp(-e*e))}function to(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),n<=0?0:Math.exp(-(t-e)*(t-e)/n/2)/Math.sqrt(2*Math.PI*n)}const no=[270/1024,80/1024,0,12/256,8/256,120/1024,0,60/1024,4/256,60/1024,4/256,30/1024,24/256,.15625,1/64,1/64,24/256,1/64,12/256,0,6/256,2/16,6/256,0,81/256,.0625,0,27/64,12/64,0,1/16,1/16,12/64,1/16,6/64,3/4,.5,243/1024,.03125,0,108/256,.125,0,9/64,6/64,.1875,0,24/256,3/64,5/1024,3/64,5/1024,0,405/1024,80/1024,0,54/256,90/1024,40/1024,0,1/256,1/256,40/1024,1/256,20/1024,9/16,.25,0,1/4,1/4,0,1/4,27/64,8/64,0,6/16,.25,10/1024,0,10/1024,2/16,0,0,0,15/1024,10/1024,1/1024,1/1024,0,1/1024],ao=[35,64,70,21,33,45,12,0,53,76,48,86];function io(e,t){const n=e.reduce(((e,t)=>e+t));if(e.length>4||n>t)return 0;if(4===e.length&&n!==t)return 0;3===e.length&&(e=[...e,t-n]),e.sort().reverse();let a=13*t+e.length-14+16*e[0];e.length>1&&(a+=4*e[1]);const i=a%12,r=Math.trunc(a/12);return no[i+ao[r]]}function ro(e,t){if(0!==e)for(let n=e;n>=0;n--)for(let a=e-n;a>=0;a--)for(let i=e-n-a;i>=0;i--){const r=e-n-a-i;t([n,a,i,r],io([n,a,i,r],e))}else t([0,0,0,0],1)}function lo(e,t,n){if(t<1e-5)return e>n?{p:1,upAvg:e-n}:{p:0,upAvg:0};const a=(n-e)/Math.sqrt(t),i=(1-eo(a/Math.sqrt(2)))/2;if(a>5){const e=1/a,n=e*e;return{p:i,upAvg:Math.sqrt(t)*e*(1-2*n*(1-n*(5+37*n)))}}const r=Math.exp(-a*a/2)/Math.sqrt(2*Math.PI);return{p:i,upAvg:e-n+Math.sqrt(t)*r/i}}const so={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3},oo=Object.values(so).reduce(((e,t)=>e+t));function co(e,t){if(t.includes(e))return 0;const n=oo-t.reduce(((e,t)=>{var n;return e+(null!=(n=so[t])?n:0)}),0);return so[e]/n}function uo(e,t,n=!1,i=!1){const r=Object.assign({},e.curBuild);r[t.slot]=t;const l=function(e){const t={};return Object.values(e).forEach((e=>{e&&Object.entries(e.values).forEach((([e,n])=>{var a;return t[e]=(null!=(a=t[e])?a:0)+n}))})),t}(r),s=Object.assign({},l),o=e=>e.endsWith("_")?Fn.Z.substatValue(e,t.rarity)/1e3:Fn.Z.substatValue(e,t.rarity)/10,c=Fn.Z.rollsRemaining(t.level,t.rarity)-(4-t.subs.length);if(4===t.subs.length&&(i=!1),i){const r=Object.keys(t.values).filter((e=>!t.subs.includes(e))).filter((e=>!a.Gt.includes(e)));if(1!==r.length)throw Error("Failed to extract artifact main stat");const d=r[0],u=Ys.filter((e=>!t.subs.includes(e)&&e!==d)),h=u.map((a=>{const r=[...t.subs,a],s={rollsLeft:c,subs:r,calc4th:i,stats:l,thresholds:e.thresholds,objectiveEval:t=>e.evalFn(t).map((({v:e,grads:t})=>({v:e,ks:r.map((e=>t[Ys.indexOf(e)]*o(e)))}))),scale:o},u=n?Zo(s):ho(s);return Object.assign({},u,{p2:co(a,[...t.subs,d])})})),Z=h.reduce(((e,{prob:t,p2:n})=>e+t*n),0),p=Z<1e-6?0:h.reduce(((e,{prob:t,p2:n,upAvg:a})=>e+t*n*a),0)/Z,m=h.reduce(((e,{p2:t,distr:n})=>(e.lower=Math.min(e.lower,n.lower),e.upper=Math.max(e.upper,n.upper),e.gmm.push(...n.gmm.map((({phi:e,cp:n,mu:a,sig2:i})=>({phi:t*e,cp:n,mu:a,sig2:i})))),e)),{gmm:[],lower:1/0,upper:-1/0});return{id:t.id,subs:t.subs,fourthsubOpts:u.map((e=>({sub:e,subprob:co(e,[...t.subs,d])}))),rollsLeft:c,statsBase:s,prob:Z,upAvg:p,distr:m,evalFn:e.evalFn,skippableDerivs:e.skippableDerivs,thresholds:e.thresholds,evalMode:n?"slow":"fast"}}{const a={rollsLeft:c,subs:t.subs,calc4th:i,stats:l,thresholds:e.thresholds,objectiveEval:n=>e.evalFn(n).map((({v:e,grads:n})=>({v:e,ks:t.subs.map((e=>n[Ys.indexOf(e)]*o(e)))}))),scale:o},r=n?Zo(a):ho(a);return Object.assign({id:t.id,subs:t.subs,rollsLeft:c,statsBase:s},r,{evalFn:e.evalFn,skippableDerivs:e.skippableDerivs,thresholds:e.thresholds,evalMode:n?"slow":"fast"})}}function ho({rollsLeft:e,subs:t,stats:n,thresholds:a,calc4th:i,scale:r,objectiveEval:l}){const s=Object.assign({},n);t.forEach(((t,n)=>{var a;const l=i&&3===n?1:0;s[t]=(null!=(a=s[t])?a:0)+8.5*(e/4+l)*r(t)}));const o=e,c=l(s);let d=1,u=-1,h={gmm:[],lower:c[0].v,upper:c[0].v};for(let Z=0;Z<c.length;Z++){const{v:e,ks:t}=c[Z],n=t.reduce(((e,t)=>e+t)),r=e,l=(147/8*t.reduce(((e,t)=>e+t*t),0)-289/64*n*n)*o+(i?5/4*t[3]*t[3]:0),{p:s,upAvg:p}=lo(r,l,a[Z]);0===Z&&(u=p,h={gmm:[{phi:1,mu:r,sig2:l,cp:1}],lower:r-4*Math.sqrt(l),upper:r+4*Math.sqrt(l)}),d=Math.min(s,d)}return{prob:d,upAvg:u,distr:h}}function Zo({rollsLeft:e,stats:t,subs:n,thresholds:a,calc4th:i,scale:r,objectiveEval:l}){const s={gmm:[],lower:a[0],upper:a[0]},o=[];ro(e,((e,c)=>{const d=Object.assign({},t);i&&(e[3]+=1),n.forEach(((t,n)=>{var a;d[t]=(null!=(a=d[t])?a:0)+8.5*e[n]*r(t)}));const u=l(d),h=u.map((e=>e.v)),Z=u.map((t=>u.map((n=>t.ks.reduce(((a,i,r)=>a+t.ks[r]*n.ks[r]*e[r]),0))))),p=function(e,t,n){let a=1,i=1;for(let l=0;l<e.length;++l){if(t[l][l]<1e-5){if(e[l]<n[l])return{p:0,upAvg:0,cp:0};continue}const r=(1-eo((n[l]-e[l])/Math.sqrt(t[l][l])/Math.sqrt(2)))/2;a*=r,0!==l&&(i*=r)}const{upAvg:r}=lo(e[0],t[0][0],n[0]);return{p:a,upAvg:r,cp:i}}(h,Z,a);o.push(Object.assign({l:c},p)),s.gmm.push({phi:c,mu:h[0],sig2:Z[0][0],cp:p.cp}),s.lower=Math.min(s.lower,h[0]-4*Math.sqrt(Z[0][0])),s.upper=Math.max(s.upper,h[0]+4*Math.sqrt(Z[0][0]))}));let c=0,d=0;return o.forEach((({l:e,p:t,upAvg:n,cp:a})=>{c+=e*t*a,d+=e*t*a*n})),c<1e-10?{prob:0,upAvg:0,distr:s}:(d/=c,{prob:c,upAvg:d,distr:s})}function po(e,t,n){let a=!0;return(0,yt.aD)([e],(e=>{}),(e=>{const{operation:i}=e;if("read"===i){if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${i}] node in zero_deriv`);t(e)===n&&(a=!1)}})),a}function mo(e,t,n){const{operation:a}=e;switch(a){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${a}] node in d/dx`);return t(e)===n?(0,Ct.a9)(1):(0,Ct.a9)(0);case"const":return(0,Ct.a9)(0);case"res":if(!po(e,t,n))throw new Error(`[${a}] node takes only constant inputs. ${e}`);return(0,Ct.a9)(0);case"add":return(0,Ct.Sm)(...e.operands.map((e=>mo(e,t,n))));case"mul":{const a=e.operands.map(((a,i)=>(0,Ct.WV)(mo(a,t,n),...e.operands.filter(((e,t)=>t!==i)))));return(0,Ct.Sm)(...a)}case"sum_frac":{const a=e.operands[0],i=mo(a,t,n),r=(0,Ct.Sm)(...e.operands.slice(1)),l=mo(r,t,n),s=(0,Ct.WV)((0,Ct.Sm)(...e.operands),(0,Ct.Sm)(...e.operands)),o=(0,Ct.Sm)((0,Ct.WV)(r,i),(0,Ct.WV)(-1,a,l));return(0,Ct.F9)(o,(0,Ct.Sm)((0,Ct.WV)(-1,o),s))}case"min":case"max":if(1===e.operands.length)return mo(e.operands[0],t,n);if(2===e.operands.length){const[i,r]=e.operands;if("min"===a)return(0,Ct.Lj)(i,r,mo(r,t,n),mo(i,t,n));if("max"===a)return(0,Ct.Lj)(i,r,mo(i,t,n),mo(r,t,n));(0,vi.UT)(a);break}if("min"===a)return mo((0,Ct.VV)(e.operands[0],(0,Ct.VV)(...e.operands.slice(1))),t,n);if("max"===a)return mo((0,Ct.Fp)(e.operands[0],(0,Ct.Fp)(...e.operands.slice(1))),t,n);(0,vi.UT)(a);break;case"threshold":{const[i,r,l,s]=e.operands;if(!po(i,t,n)||!po(r,t,n))throw new Error(`[${a}] node must branch on constant inputs. ${e}`);return(0,Ct.Lj)(i,r,mo(l,t,n),mo(s,t,n))}default:(0,vi.UT)(a)}}function fo(e,t,n){const a=[];e.forEach((e=>{a.push(e,...Ys.map((t=>mo(e,(e=>e.path[1]),t))))}));const i=(0,vt.tL)(a,{},(e=>!1)),r=(0,vt.I3)(i,{},(e=>e.path[1]),1),l=function(e){const t={};return Object.values(e).forEach((e=>{e&&Object.entries(e.values).forEach((([e,n])=>{var a;return t[e]=(null!=(a=t[e])?a:0)+n}))})),t}(n),s=r([{id:"",values:l}])[0],o=Ys.map((t=>e.every((e=>po(e,(e=>e.path[1]),t)))));return{formulas:e,thresholds:[s,...t],curBuild:n,evalFn:t=>{const n=r([{id:"",values:t}]);return e.map(((e,t)=>{const a=t*(1+Ys.length);return{v:n[a],grads:Ys.map(((e,t)=>n[a+1+t]))}}))},skippableDerivs:o}}function go(e,t){void 0===t&&(t=e.level);const n=Fn.Z.mainStatValue(e.mainStatKey,e.rarity,t),a={id:e.id,slot:e.slotKey,level:e.level,rarity:e.rarity,values:Object.assign({[e.setKey]:1,[e.mainStatKey]:e.mainStatKey.endsWith("_")?n/100:n},Object.fromEntries(e.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue])))),subs:e.substats.reduce(((e,t)=>(""!==t.key&&e.push(t.key),e)),[])};return delete a.values[""],a}function xo(e,t){if(t.prob>1e-5||e.prob>1e-5)return t.prob*t.upAvg-e.prob*e.upAvg;const n=e.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0);return t.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0)-n}var bo=n(81073),vo=n(30840),yo=n(15045);const Co=50;function wo({upgradeOpt:e,objMin:t,objMax:n}){const[i,r]=(0,x.useState)(!1),{database:l}=(0,x.useContext)(T.t),s=l.arts.get(e.id);if(!s)throw new Error(`artifact ${e.id} not found.`);const o=e.thresholds.length>1,c=s.slotKey,{data:d}=(0,x.useContext)(K.R),u=(0,x.useMemo)((()=>a.Ex.map((e=>{var t;return[e,l.arts.get(null!=(t=d.get(ve.ri.art[e].id).value)?t:"")]}))),[d,l]),Z=t=>e.distr.gmm.reduce(((e,{phi:n,cp:a,mu:i,sig2:r})=>e+a*n*to(t,i,r)),0),m=e.thresholds,f=m[0],b=(0,x.useCallback)((e=>100*(e-f)/f),[f]),v=t,y=n;let C=0;const B=function(e=0,t=1,n=50){const a=[],i=(t-e)/n;for(let r=0;r<n;++r)a.push(e+r*i);return a}(v,y,500).map((t=>{const n=(a=t,e.distr.gmm.reduce(((e,{phi:t,mu:n,sig2:i})=>e+t*to(a,n,i)),0));var a;return C=Math.max(C,n),{x:b(t),est:n,estCons:Z(t)}}));0===C&&(C=Co/(y-v));const S={},k={};e.distr.gmm.forEach((({phi:e,mu:t,sig2:n,cp:a})=>{var i,r;n<=0&&(S[t]=(null!=(i=S[t])?i:0)+e,k[t]=(null!=(r=k[t])?r:0)+e*a)})),Object.entries(S).forEach((([e,t])=>B.push({x:b(parseFloat(e)),est:t*Co/(y-v),estCons:k[e]*Co/(y-v)}))),B.sort(((e,t)=>e.x-t.x));const X=(f-v)/(y-v),[_,j]=(0,x.useState)([]),[P,E]=(0,x.useState)(-1),[O,A]=(0,x.useState)(-1);if((0,x.useEffect)((()=>{if(!i)return;const t=function({statsBase:e,rollsLeft:t,subs:n,skippableDerivs:a,fourthsubOpts:i,evalFn:r}){const l=e=>e.endsWith("_")?Fn.Z.substatValue(e,5)/1e3:Fn.Z.substatValue(e,5)/10,s=e,o=[];return ro(t,((e,t)=>{i&&(e[3]+=1);const c=e.map(((e,t)=>{if(i&&3===t)return(0,vi.w6)(7*e,10*e);const r=n[t];return r&&!a[Ys.indexOf(r)]?(0,vi.w6)(7*e,10*e):[NaN]}));(0,vi.Og)(...c).forEach((a=>{const c=Object.assign({},s);let d=1;for(let t=0;t<3;t++){var u;if(isNaN(a[t]))continue;const i=n[t],r=a[t],s=e[t];c[i]=(null!=(u=c[i])?u:0)+r*l(i);const o=4**-s*Qs(s,r-7*s);d*=o}if(void 0===i){if(!isNaN(a[3])){var h;const t=n[3],i=a[3],r=e[3];c[t]=(null!=(h=c[t])?h:0)+i*l(t);const s=4**-r*Qs(r,i-7*r);d*=s}o.push({v:r(c).map((e=>e.v)),p:t*d})}else i.forEach((({sub:n,subprob:i})=>{var s;const u=Object.assign({},c),h=n,Z=a[3],p=e[3];u[h]=(null!=(s=u[h])?s:0)+Z*l(h);const m=4**-p*Qs(p,Z-7*p)*i,f=d*m;o.push({v:r(u).map((e=>e.v)),p:t*f})}))}))})),o}(e);let n=0,a=0;const r=new Array(Co).fill(0),l=new Array(Co).fill(0),s=(y-v)/Co;t.forEach((({p:e,v:t})=>{const i=Math.min(Math.trunc((t[0]-v)/s),49);r[i]+=e,t.every(((e,t)=>0===t||e>m[t]))&&(l[i]+=e,t[0]>f&&(n+=e,a+=e*(t[0]-f)))})),n>0&&(a/=n);const o=r.map(((e,t)=>({x:b(v+t*s),exact:e/s,exactCons:l[t]/s})));E(n),A(a),j(o)}),[i,y,v,f,m,e,b]),0===_.length){const e=(y-v)/Co;for(let t=0;t<Co;t++)_.push({x:b(v+t*e),exact:0,exactCons:0})}const D=P>=0?P:e.prob,M=O>=0?O:e.upAvg,L=B.concat(_);return(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)(Ba.h,{width:"100%",aspect:2.5,children:(0,z.BX)(Sa.c,{data:L,margin:{top:5,right:30,left:20,bottom:20},children:[(0,z.tZ)(Xa.K,{dataKey:"x",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:e=>`${e<=0?"":"+"}${e}%`,children:(0,z.tZ)(_a._,{value:"Relative Damage Potential",position:"insideBottom",style:{fill:"#eaebed"},offset:-10})}),(0,z.tZ)(Ka.B,{type:"number",domain:[0,C],tick:!1,children:(0,z.tZ)(_a._,{value:"Probability",position:"insideLeft",angle:-90,style:{fill:"#eaebed"}})}),(0,z.tZ)(Pa.D,{verticalAlign:"top",height:36}),(0,z.tZ)("defs",{children:(0,z.BX)("linearGradient",{id:`splitOpacity${e.id}`,x1:"0",y1:"0",x2:X,y2:"0",children:[(0,z.tZ)("stop",{offset:1,stopColor:"orange",stopOpacity:0}),(0,z.tZ)("stop",{offset:0,stopColor:"orange",stopOpacity:1})]})}),(0,z.tZ)(Ea.x,{dataKey:"dne",stroke:"red",name:"Current Damage"}),o&&!i&&(0,z.tZ)(bo.u,{type:"monotone",dataKey:"est",stroke:"grey",dot:!1,fill:"grey",legendType:"none",tooltipType:"none",opacity:.5,activeDot:!1}),o&&i&&(0,z.tZ)(bo.u,{type:"stepAfter",dataKey:"exact",dot:!1,legendType:"none",tooltipType:"none",opacity:.7,activeDot:!1,fill:"grey",stroke:"grey"}),(0,z.tZ)(bo.u,{type:"monotone",dataKey:"estCons",stroke:"orange",dot:!1,fill:`url(#splitOpacity${e.id})`,opacity:.5,name:"Estimated Distribution",activeDot:!1}),i&&(0,z.tZ)(bo.u,{type:"stepAfter",dataKey:"exactCons",dot:!1,opacity:.7,name:`Exact${o?" Constrained":""} Distribution (Histogram)`,activeDot:!1}),(0,z.tZ)(vo.d,{x:b(f),stroke:"red",strokeDasharray:"3 3",name:"Current Damage"}),(0,z.tZ)(yo.q,{x:b(f+M),y:(Z(f+M)||C)/2,shape:(0,z.tZ)("circle",{radius:1,opacity:.5})}),(0,z.tZ)(ja.u,{content:(0,z.tZ)((({active:e})=>e?(0,z.BX)("div",{className:"custom-tooltip",children:[(0,z.tZ)("p",{className:"label"}),(0,z.BX)("p",{className:"desc",children:["prob. upgrade",P>=0?"":" (est.)",":"," ",(100*D).toFixed(1),"%"]}),(0,z.BX)("p",{className:"desc",children:["average increase",O>=0?"":" (est.)",":"," ",M<=0?"":"+",(100*M/f).toFixed(1),"%"]})]}):null),{}),cursor:!1})]})},e.id),(0,z.tZ)(ue.ZP,{direction:"row",container:!0,spacing:.75,columns:12,children:u.map((([t,n])=>t!==c?(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Ia.Z,{slotKey:t,artifactObj:n})},`${t}_${e.id}`):(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(g.Z,{variant:"contained",style:{height:"100%",width:"100%"},onClick:()=>r(!0),startIcon:(0,z.tZ)(h.Z,{sx:{position:"absolute",width:"70%",height:"70%",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.7},component:"img",src:Gn.CL.slot[t]}),sx:{minWidth:0}})},`${t}_${e.id}`)))}),(0,z.tZ)("br",{}),(0,z.tZ)("span",{children:"Click above to calculate Exact upgrade distribution"}),(0,z.tZ)("br",{})]})})}function Bo(){var e;const{character:{key:t}}=(0,x.useContext)(_.K),{database:n}=(0,x.useContext)(T.t),{gender:i}=(0,M.Z)(),r=(0,N.Z)(),l=(0,x.useMemo)((()=>!n.arts.values.length),[n]),{buildSetting:s,buildSettingDispatch:o}=Gt(t),{optimizationTarget:c,levelLow:d,levelHigh:u}=s,m=(0,L.Z)(t),{target:f}=null!=(e=null==m?void 0:m[t])?e:{},[b]=function(){const[e,t]=(0,x.useState)({});return[e,(0,x.useCallback)((()=>t({})),[])]}(),[,v]=(0,x.useState)(n.displayOptimize.get());(0,x.useEffect)((()=>n.displayOptimize.follow(((e,t)=>v(t)))),[n,v]);const B=(0,x.useDeferredValue)(b),k=(0,x.useDeferredValue)(s),X=(0,x.useMemo)((()=>{const{mainStatKeys:e,excludedLocations:i,artExclusion:r,levelLow:l,levelHigh:s,allowLocationsState:o,useExcludedArts:c}=B&&k;return n.arts.values.filter((n=>{if(!c&&r.includes(n.id))return!1;if(n.level<l)return!1;if(n.level>s)return!1;const d=e[n.slotKey];if(null!=d&&d.length&&!d.includes(n.mainStatKey))return!1;const u=(0,a.V7)(t),h="unequippedOnly"===o&&n.location&&n.location!==u,Z="customList"===o&&n.location&&n.location!==u&&i.includes(n.location);return!h&&!Z}))}),[n,t,B,k]),j=(0,x.useMemo)((()=>(0,vi.O)(X.map((({id:e})=>e)),(e=>!0))),[X]),[P,E]=(0,x.useState)(void 0),[O,A]=(0,x.useState)(!0),[D,I]=(0,x.useState)(!0),[R,G]=(0,x.useState)(!1),W=(0,x.useCallback)((({query:e,arts:t},a,i)=>{const r=n.arts.values.filter((e=>5===e.rarity)).map((e=>go(e,20))),l={};r.forEach((e=>l[e.id]=e));const s=t.slice(0,a),o=t.slice(a);let c=0;const d=Math.min(i-a+5,o.length);do{for(;c<d;c++){const t=l[o[c].id];t&&(o[c]=uo(e,t,!0,D))}for(o.sort(xo),c=0;c<d&&"fast"!==o[c].evalMode;c++);}while(c<d);return{query:e,arts:[...s,...o]}}),[n,D]),[$,V]=(0,x.useState)(0),F=(0,x.useRef)(null),{artifactsToShow:q,numPages:H,currentPageIndex:U,minObj0:Y,maxObj0:J}=(0,x.useMemo)((()=>{if(!P)return{artifactsToShow:[],numPages:0,toShow:0,minObj0:0,maxObj0:0};const e=Math.ceil(P.arts.length/5),t=(0,vi.uZ)($,0,e-1),n=P.arts.slice(5*t,5*(t+1)),a=n.length>0?n[0].thresholds[0]:0;return{artifactsToShow:n,numPages:e,currentPageIndex:t,minObj0:n.reduce(((e,t)=>Math.min(t.distr.lower,e)),a),maxObj0:n.reduce(((e,t)=>Math.max(t.distr.upper,e)),a)}}),[P,5,$]),Q=(0,x.useCallback)(((e,t)=>{var n;if(!P)return;null==(n=F.current)||n.scrollIntoView({behavior:"smooth"});const a=W(P,5*(U+1),5*t);E(a),V(t-1)}),[V,E,F,U,5,P,W]),ee=(0,x.useCallback)((async()=>{var e,r,l,o;const{statFilters:c,optimizationTarget:d,mainStatKeys:u,levelLow:h,levelHigh:Z,artSetExclusion:p}=s;if(!t||!d)return;const m=await(0,L.V)(n,t,0,[]);if(!m)return;const f=null==(e=(0,bt.Qo)(m.teamData,i,t)[t])?void 0:e.target.data[0];if(!f)return;Object.assign(f,(0,bt.b3)([f,_i]));const g=(0,vi.Hm)(null!=(r=f.display)?r:{},d);if(!g)return;E(void 0),V(0);const x=Object.entries(c).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,a;const i=(0,vi.Hm)(null!=(n=f.display)?n:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(a=i.info)?void 0:a.unit)?t.value/100:t.value}})))),b=null!=(l=null==(o=n.chars.get(t))?void 0:o.equippedArtifacts)?l:{},v=(0,vi.O)(a.Ex,(e=>{var t;const a=n.arts.get(null!=(t=b[e])?t:"");return a?go(a):void 0})),y=(0,vi.O)(a.Ex,(e=>{var t,a;const i=n.arts.get(null!=(t=b[e])?t:"");return null!=(a=null==i?void 0:i.setKey)?a:""}));const C=n.arts.values.filter((e=>5===e.rarity)).filter((function(e){const t=Object.assign({},y);t[e.slotKey]=e.setKey;const n={};if(a.Ex.forEach((e=>{var a;return n[t[e]]=(null!=(a=n[t[e]])?a:0)+1})),!Object.entries(n).every((([e,t])=>{if(!p[e])return!0;switch(t){case 0:case 1:return!0;case 2:case 3:return!p[e].includes(2);case 4:case 5:return!p[e].includes(4);default:throw Error("error in respectSex: num > 5")}})))return!1;if(!p.rainbow)return!0;switch(Object.values(n).reduce(((e,t)=>e+t%2),0)){case 0:case 1:return!0;case 2:case 3:return!p.rainbow.includes(2);case 4:case 5:return!p.rainbow.includes(4);default:throw Error("error in respectSex: nRainbow > 5")}})).filter((e=>O||20!==e.level)).filter((e=>{var t,n;return!R||!(null!=(t=u[e.slotKey])&&t.length)||(null==(n=u[e.slotKey])?void 0:n.includes(e.mainStatKey))})).filter((e=>!R||h<=e.level&&e.level<=Z)).map((e=>go(e,20))),w={};C.forEach((e=>w[e.id]=e));const B=[g,...x.map((e=>e.value))],S=fo((0,vt.tL)(B,f,(({path:[e]})=>"dyn"!==e)),x.map((e=>e.minimum)),v);let k=C.map((e=>uo(S,e,!1,D)));k=k.sort(((e,t)=>t.prob*t.upAvg-e.prob*e.upAvg));let X={query:S,arts:k};X=W(X,0,5),E(X),console.log("result",X)}),[s,t,n,i,W,O,R,D]),te=(0,x.useMemo)((()=>f&&m&&{data:f,teamData:m}),[f,m]);return(0,z.BX)(h.Z,{display:"flex",flexDirection:"column",gap:1,children:[l&&(0,z.BX)(he.Z,{severity:"warning",variant:"filled",children:[" ","Opps! It looks like you haven't added any artifacts to GO yet! You should go to the"," ",(0,z.tZ)(st.Z,{component:y.rU,to:"/artifact",children:"Artifacts"})," ","page and add some!"]}),te&&(0,z.tZ)(K.R.Provider,{value:te,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(ht.Z,{characterKey:t,onClickTeammate:r})}),(0,z.tZ)(En,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:9,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(w.Z,{children:(0,z.BX)(p.Z,{children:[(0,z.tZ)("span",{children:"Optimization Target: "}),(0,z.tZ)(Aa.Z,{optimizationTarget:c,setTarget:e=>o({optimizationTarget:e}),disabled:!1})]})}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(ki,{disabled:!1})})}),R&&(0,z.BX)(w.Z,{children:[(0,z.tZ)(p.Z,{sx:{py:1},children:"Artifact Level Filter"}),(0,z.tZ)(dt.Z,{levelLow:d,levelHigh:u,setLow:e=>o({levelLow:e}),setHigh:e=>o({levelHigh:e}),setBoth:(e,t)=>o({levelLow:e,levelHigh:t}),disabled:!1}),(0,z.tZ)(p.Z,{children:(0,z.tZ)(bi,{disabled:!1,filteredArtIdMap:j})})]})]}),(0,z.BX)(ue.ZP,{item:!0,lg:8,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.tZ)(Bn,{disabled:!1})})}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:O?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:O?"success":"secondary",onClick:()=>A(!O),children:"show lvl 20"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:D?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:D?"success":"secondary",onClick:()=>I(!D),children:"compute 4th sub"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{startIcon:R?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:R?"success":"secondary",onClick:()=>G(!R),children:"enable filters"})})]})})})]})]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,lg:12,children:(0,z.tZ)(w.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(g.Z,{disabled:!t||!c||!(0,vi.Hm)(null==f?void 0:f.getDisplay(),c),color:t?"success":"warning",onClick:ee,startIcon:(0,z.tZ)(Hs.Z,{}),children:"Calc Upgrade Priority"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(S.oX,{size:"small"})})]})})})}),H>1&&(0,z.tZ)(C.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Us.Z,{count:H,page:U+1,onChange:Q})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(So,{numShowing:q.length,total:null==P?void 0:P.arts.length})})]})})}),(0,z.tZ)(ue.ZP,{item:!0,lg:12,spacing:1,children:(0,z.BX)(ue.ZP,{container:!0,display:"flex",flexDirection:"column",gap:1,children:[l&&(0,z.BX)(he.Z,{severity:"info",variant:"filled",children:["Looks like you haven't added any artifacts yet. If you want, there are"," ",(0,z.tZ)(st.Z,{color:"warning.main",component:y.rU,to:"/scanner",children:"automatic scanners"})," ","that can speed up the import process!"]}),(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",sx:{width:"100%",height:600,minHeight:5e3}}),children:q.map((e=>(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:5,sm:4,md:4,lg:3,xl:3,children:(0,z.tZ)(ua.Z,{artifactId:e.id,editorProps:{}})}),(0,z.tZ)(ue.ZP,{item:!0,xs:7,sm:8,md:8,lg:9,xl:9,children:(0,z.tZ)(wo,{upgradeOpt:e,objMax:J,objMin:Y})})]},e.id+"asdfsf")))})]})}),H>1&&(0,z.tZ)(C.Z,{children:(0,z.tZ)(p.Z,{children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Us.Z,{count:H,page:U+1,onChange:Q})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(So,{numShowing:q.length,total:null==P?void 0:P.arts.length})})]})})})]})]})]})})]})}function So({numShowing:e,total:t}){return(0,z.tZ)(Y.Z,{color:"text.secondary",children:(0,z.BX)(b.cC,{i18nKey:"showingNum",count:e,value:t,children:["Showing ",{count:e}," out of ",{value:t}," Artifacts"]})})}let ko,Xo=e=>e;function _o(){const e=(0,v.s0)(),{database:t}=(0,x.useContext)(T.t),n=(0,x.useCallback)((()=>e("/characters")),[e]),{characterKey:a}=(0,v.UO)();return!t.chars.keys.includes(a)?(0,z.tZ)(v.Fg,{to:"/characters"}):(0,z.tZ)(h.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3}),children:a&&(0,z.tZ)(Ko,{characterKey:a,onClose:n},a)})})}function Ko({characterKey:e,onClose:t}){var n,i,r;const{silly:l}=(0,x.useContext)(E.E),s=(0,A.Z)(e),{gender:o}=(0,M.Z)(),c=(0,O.m)(e,o),d=(0,L.Z)(e),{target:u}=null!=(n=null==d?void 0:d[e])?n:{},{params:{tab:m="overview"}}=null!=(i=(0,v.bS)({path:"/characters/:charKey/:tab",end:!1}))?i:{params:{tab:"overview"}},{t:f}=(0,b.$G)(["sillyWisher_charNames","charNames_gen","page_character"]);(0,I.Z)((0,x.useMemo)((()=>`${f(`${l?"sillyWisher_charNames":"charNames_gen"}:${(0,a.Cs)(e,o)}`)} - ${f(`page_character:tabs.${m}`)}`),[f,l,e,o,m]));const g=(0,D.Z)(null!=(r=null==s?void 0:s.key)?r:""),y=(0,x.useMemo)((()=>{if(d&&u)return{data:u,teamData:d,oldData:void 0}}),[u,d]),X=(0,x.useMemo)((()=>{if(s&&c)return{character:s,characterSheet:c,characterDispatch:g}}),[s,c,g]),[T,G]=(0,x.useState)(void 0),[N,W]=(0,x.useState)(),V=(0,x.useMemo)((()=>({chartData:T,setChartData:G,graphBuilds:N,setGraphBuilds:W})),[T,N]);return(0,x.useEffect)((()=>{G(void 0),W(void 0)}),[e]),(0,z.tZ)(C.Z,{children:y&&X&&V?(0,z.tZ)(_.K.Provider,{value:X,children:(0,z.tZ)(K.R.Provider,{value:y,children:(0,z.tZ)(P.Provider,{value:V,children:(0,z.tZ)(j.B,{children:(0,z.BX)(p.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(h.Z,{display:"flex",children:[(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,z.tZ)($,{}),(0,z.tZ)($s,{}),(0,z.tZ)(qs,{}),(0,z.tZ)(Eo,{}),(0,z.tZ)(R.J,{}),(0,z.tZ)(Oo,{})]}),!!t&&(0,z.tZ)(B.Z,{onClick:t})]}),(0,z.BX)(h.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[s&&(0,z.tZ)(k.Z,{level:s.level,ascension:s.ascension,setBoth:g}),(0,z.tZ)(S.Hn,{size:"small"}),(0,z.tZ)(S.pg,{}),(0,z.tZ)(S.oX,{size:"small"})]}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(Po,{tab:m})}),(0,z.tZ)(jo,{}),(0,z.tZ)(w.Z,{children:(0,z.tZ)(Po,{tab:m})})]})})})})}):(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:1e3})})}function jo(){return(0,z.tZ)(x.Suspense,{fallback:(0,z.tZ)(Z.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,z.BX)(v.Z5,{children:[(0,z.tZ)(v.AW,{index:!0,element:(0,z.tZ)(es,{})}),(0,z.tZ)(v.AW,{path:"/talent",element:(0,z.tZ)(cs,{})}),(0,z.tZ)(v.AW,{path:"/teambuffs",element:(0,z.tZ)(xs,{})}),(0,z.tZ)(v.AW,{path:"/optimize",element:(0,z.tZ)(Li,{})}),(0,z.tZ)(v.AW,{path:"/theorycraft",element:(0,z.tZ)(Ds,{})}),(0,z.tZ)(v.AW,{path:"/upopt",element:(0,z.tZ)(Bo,{})})]})})}function Po({tab:e}){const{t}=(0,b.$G)("page_character");return(0,z.BX)(m.Z,{value:e,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"overview",label:t("tabs.overview"),icon:(0,z.tZ)(r.Z,{}),component:y.rU,to:""}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"talent",label:t("tabs.talent"),icon:(0,z.tZ)(l.Z,{}),component:y.rU,to:"talent"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"teambuffs",label:t("tabs.teambuffs"),icon:(0,z.tZ)(s.Z,{}),component:y.rU,to:"teambuffs"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"optimize",label:t("tabs.optimize"),icon:(0,z.tZ)(o.Z,{}),component:y.rU,to:"optimize"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"theorycraft",label:t("tabs.theorycraft"),icon:(0,z.tZ)(c.Z,{}),component:y.rU,to:"theorycraft"}),(0,z.tZ)(f.Z,{sx:{minWidth:"16.6%"},value:"upopt",label:t("tabs.upgradeopt"),icon:(0,z.tZ)(o.Z,{}),component:y.rU,to:"upopt"})]})}function Eo(){const{t:e}=(0,b.$G)("page_character"),[t,n,a]=(0,i.aV)(),{character:{bonusStats:r}}=(0,x.useContext)(_.K),l=Object.keys(r).length;return(0,z.BX)(z.HY,{children:[(0,z.BX)(g.Z,{color:"info",startIcon:(0,z.tZ)(d.Z,{}),onClick:n,children:[e(ko||(ko=Xo`addStats.title`)),!!l&&(0,z.tZ)(X.Z,{sx:{ml:1},color:"success",children:l})]}),(0,z.tZ)(We,{open:t,onClose:a})]})}function Oo(){const{onModalOpen:e}=(0,x.useContext)(j.M);return(0,z.BX)(z.HY,{children:[(0,z.BX)(g.Z,{color:"info",startIcon:(0,z.tZ)(u.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,z.tZ)(le,{})]})}}}]);